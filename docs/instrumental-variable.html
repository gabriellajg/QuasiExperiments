<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Instrumental Variable | R Book for Quasi-Experimental Designs</title>
  <meta name="description" content="Chapter 4 Instrumental Variable | R Book for Quasi-Experimental Designs" />
  <meta name="generator" content="bookdown 0.28 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Instrumental Variable | R Book for Quasi-Experimental Designs" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Instrumental Variable | R Book for Quasi-Experimental Designs" />
  
  
  

<meta name="author" content="Ge Jiang" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="types-of-causal-effects.html"/>
<link rel="next" href="psm-matching-strategy.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R for Quasi-exp Designs</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Course</a></li>
<li class="chapter" data-level="2" data-path="regression-approach-to-treatment-effect-estimation.html"><a href="regression-approach-to-treatment-effect-estimation.html"><i class="fa fa-check"></i><b>2</b> Regression Approach to Treatment Effect Estimation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="regression-approach-to-treatment-effect-estimation.html"><a href="regression-approach-to-treatment-effect-estimation.html#regression-w-no-confounder"><i class="fa fa-check"></i><b>2.1</b> Regression w/ no confounder</a></li>
<li class="chapter" data-level="2.2" data-path="regression-approach-to-treatment-effect-estimation.html"><a href="regression-approach-to-treatment-effect-estimation.html#including-confounder-ses"><i class="fa fa-check"></i><b>2.2</b> Including confounder SES</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="regression-approach-to-treatment-effect-estimation.html"><a href="regression-approach-to-treatment-effect-estimation.html#low-ses"><i class="fa fa-check"></i><b>2.2.1</b> low SES</a></li>
<li class="chapter" data-level="2.2.2" data-path="regression-approach-to-treatment-effect-estimation.html"><a href="regression-approach-to-treatment-effect-estimation.html#middle-ses"><i class="fa fa-check"></i><b>2.2.2</b> middle SES</a></li>
<li class="chapter" data-level="2.2.3" data-path="regression-approach-to-treatment-effect-estimation.html"><a href="regression-approach-to-treatment-effect-estimation.html#high-ses"><i class="fa fa-check"></i><b>2.2.3</b> high SES</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="types-of-causal-effects.html"><a href="types-of-causal-effects.html"><i class="fa fa-check"></i><b>3</b> Types of Causal Effects</a>
<ul>
<li class="chapter" data-level="3.1" data-path="types-of-causal-effects.html"><a href="types-of-causal-effects.html#att-ate-atu-what-the-what"><i class="fa fa-check"></i><b>3.1</b> ATT, ATE, ATU, â€¦ what the what?</a></li>
<li class="chapter" data-level="3.2" data-path="types-of-causal-effects.html"><a href="types-of-causal-effects.html#calculating-different-causal-effects-in-practice"><i class="fa fa-check"></i><b>3.2</b> Calculating different causal effects in practice</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="instrumental-variable.html"><a href="instrumental-variable.html"><i class="fa fa-check"></i><b>4</b> Instrumental Variable</a>
<ul>
<li class="chapter" data-level="4.1" data-path="instrumental-variable.html"><a href="instrumental-variable.html#loading-data"><i class="fa fa-check"></i><b>4.1</b> Loading Data</a></li>
<li class="chapter" data-level="4.2" data-path="instrumental-variable.html"><a href="instrumental-variable.html#setup"><i class="fa fa-check"></i><b>4.2</b> Setup</a></li>
<li class="chapter" data-level="4.3" data-path="instrumental-variable.html"><a href="instrumental-variable.html#regression-approaches"><i class="fa fa-check"></i><b>4.3</b> Regression Approaches</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="instrumental-variable.html"><a href="instrumental-variable.html#naive-regression-ols-estimate-with-treatment-only"><i class="fa fa-check"></i><b>4.3.1</b> Naive Regression: OLS estimate with treatment only</a></li>
<li class="chapter" data-level="4.3.2" data-path="instrumental-variable.html"><a href="instrumental-variable.html#regression-with-covariates"><i class="fa fa-check"></i><b>4.3.2</b> Regression with covariates</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="instrumental-variable.html"><a href="instrumental-variable.html#iv-does-education-effect-wages-when-college-proximity-is-used-as-the-instrument"><i class="fa fa-check"></i><b>4.4</b> IV: Does education effect wages when college proximity is used as the instrument?</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="instrumental-variable.html"><a href="instrumental-variable.html#stage-1-t-on-iv"><i class="fa fa-check"></i><b>4.4.1</b> Stage 1: T on IV</a></li>
<li class="chapter" data-level="4.4.2" data-path="instrumental-variable.html"><a href="instrumental-variable.html#stage-2-y-on-t_hat"><i class="fa fa-check"></i><b>4.4.2</b> Stage 2: Y on T_hat</a></li>
<li class="chapter" data-level="4.4.3" data-path="instrumental-variable.html"><a href="instrumental-variable.html#all-in-one-function-ivreg"><i class="fa fa-check"></i><b>4.4.3</b> All-in-one function ivreg():</a></li>
<li class="chapter" data-level="4.4.4" data-path="instrumental-variable.html"><a href="instrumental-variable.html#diagnostic-tests"><i class="fa fa-check"></i><b>4.4.4</b> Diagnostic tests:</a></li>
<li class="chapter" data-level="4.4.5" data-path="instrumental-variable.html"><a href="instrumental-variable.html#multiple-iv"><i class="fa fa-check"></i><b>4.4.5</b> Multiple IV</a></li>
<li class="chapter" data-level="4.4.6" data-path="instrumental-variable.html"><a href="instrumental-variable.html#compare-with-ols"><i class="fa fa-check"></i><b>4.4.6</b> Compare with OLS:</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="instrumental-variable.html"><a href="instrumental-variable.html#take-home-exercise"><i class="fa fa-check"></i><b>4.5</b> Take-home exercise</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="instrumental-variable.html"><a href="instrumental-variable.html#does-cigarette-smoking-have-an-effect-on-child-birth-weight-wooldridge-2002"><i class="fa fa-check"></i><b>4.5.1</b> Does cigarette smoking have an effect on child birth weight (Wooldridge, 2002)?</a></li>
<li class="chapter" data-level="4.5.2" data-path="instrumental-variable.html"><a href="instrumental-variable.html#missing-data"><i class="fa fa-check"></i><b>4.5.2</b> Missing data</a></li>
<li class="chapter" data-level="4.5.3" data-path="instrumental-variable.html"><a href="instrumental-variable.html#your-turn-now"><i class="fa fa-check"></i><b>4.5.3</b> Your turn now!!!!</a></li>
<li class="chapter" data-level="4.5.4" data-path="instrumental-variable.html"><a href="instrumental-variable.html#naive-regression-ols-estimate-with-treatment-only-1"><i class="fa fa-check"></i><b>4.5.4</b> Naive Regression: OLS Estimate with treatment only</a></li>
<li class="chapter" data-level="4.5.5" data-path="instrumental-variable.html"><a href="instrumental-variable.html#regression-with-covariates-1"><i class="fa fa-check"></i><b>4.5.5</b> Regression with covariates</a></li>
<li class="chapter" data-level="4.5.6" data-path="instrumental-variable.html"><a href="instrumental-variable.html#iv-done-manually"><i class="fa fa-check"></i><b>4.5.6</b> IV done manually</a></li>
<li class="chapter" data-level="4.5.7" data-path="instrumental-variable.html"><a href="instrumental-variable.html#ivreg"><i class="fa fa-check"></i><b>4.5.7</b> IVreg()</a></li>
<li class="chapter" data-level="4.5.8" data-path="instrumental-variable.html"><a href="instrumental-variable.html#model-comparison"><i class="fa fa-check"></i><b>4.5.8</b> Model Comparison</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html"><i class="fa fa-check"></i><b>5</b> PSM Matching Strategy</a>
<ul>
<li class="chapter" data-level="5.1" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#data"><i class="fa fa-check"></i><b>5.1</b> Data</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#create-dummy-variable-for-race-and-unemployment"><i class="fa fa-check"></i><b>5.1.1</b> Create dummy variable for race and unemployment</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#regression-estimates"><i class="fa fa-check"></i><b>5.2</b> Regression Estimates</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#naive-t-test-estimate"><i class="fa fa-check"></i><b>5.2.1</b> naive t-test estimate</a></li>
<li class="chapter" data-level="5.2.2" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#regression-with-covariates-2"><i class="fa fa-check"></i><b>5.2.2</b> regression with covariates</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#psm-steps"><i class="fa fa-check"></i><b>5.3</b> PSM Steps</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#selection-of-covariates-in-x"><i class="fa fa-check"></i><b>5.3.1</b> Selection of covariates in X</a></li>
<li class="chapter" data-level="5.3.2" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#calculation-of-propensity-scores-p-scores"><i class="fa fa-check"></i><b>5.3.2</b> Calculation of propensity scores (p-scores)</a></li>
<li class="chapter" data-level="5.3.3" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#matching-based-on-p-sores"><i class="fa fa-check"></i><b>5.3.3</b> Matching based on p-sores</a></li>
<li class="chapter" data-level="5.3.4" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#checking-balance-on-covariates"><i class="fa fa-check"></i><b>5.3.4</b> Checking balance on covariates:</a></li>
<li class="chapter" data-level="5.3.5" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#estimation-of-treatment-effect"><i class="fa fa-check"></i><b>5.3.5</b> Estimation of treatment effect</a></li>
<li class="chapter" data-level="5.3.6" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#hidden-bias-analysis"><i class="fa fa-check"></i><b>5.3.6</b> Hidden bias analysis</a></li>
<li class="chapter" data-level="5.3.7" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#references"><i class="fa fa-check"></i><b>5.3.7</b> References:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html"><i class="fa fa-check"></i><b>6</b> Propensity Score Analysis</a>
<ul>
<li class="chapter" data-level="6.1" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#data-1"><i class="fa fa-check"></i><b>6.1</b> Data</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#create-dummy-variable-for-race-and-unemployment-1"><i class="fa fa-check"></i><b>6.1.1</b> Create dummy variable for race and unemployment</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#calculating-propensity-scores"><i class="fa fa-check"></i><b>6.2</b> Calculating Propensity Scores</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#different-formulas"><i class="fa fa-check"></i><b>6.2.1</b> Different formulas</a></li>
<li class="chapter" data-level="6.2.2" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#calculation-of-propensity-scores-p-scores-1"><i class="fa fa-check"></i><b>6.2.2</b> Calculation of propensity scores (p-scores)</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#iptw-inverse-probability-treatment-weighting"><i class="fa fa-check"></i><b>6.3</b> IPTW: Inverse Probability Treatment Weighting</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#weightatt"><i class="fa fa-check"></i><b>6.3.1</b> weightATT</a></li>
<li class="chapter" data-level="6.3.2" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#weightate"><i class="fa fa-check"></i><b>6.3.2</b> weightATE</a></li>
<li class="chapter" data-level="6.3.3" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#weight-truncation"><i class="fa fa-check"></i><b>6.3.3</b> Weight truncation</a></li>
<li class="chapter" data-level="6.3.4" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#balance-check"><i class="fa fa-check"></i><b>6.3.4</b> Balance check</a></li>
<li class="chapter" data-level="6.3.5" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#estimation-of-treatment-effect-1"><i class="fa fa-check"></i><b>6.3.5</b> Estimation of treatment effect</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#stratification"><i class="fa fa-check"></i><b>6.4</b> Stratification</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#manually-creating-subclasses"><i class="fa fa-check"></i><b>6.4.1</b> Manually creating subclasses</a></li>
<li class="chapter" data-level="6.4.2" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#stratification-using-matchit"><i class="fa fa-check"></i><b>6.4.2</b> Stratification using matchit():</a></li>
<li class="chapter" data-level="6.4.3" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#covariate-balance-evaluation"><i class="fa fa-check"></i><b>6.4.3</b> Covariate Balance Evaluation</a></li>
<li class="chapter" data-level="6.4.4" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#calculate-the-stratum-weights"><i class="fa fa-check"></i><b>6.4.4</b> Calculate the stratum weights</a></li>
<li class="chapter" data-level="6.4.5" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#estimation-of-treatment-effects"><i class="fa fa-check"></i><b>6.4.5</b> Estimation of Treatment Effects</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#adjustment"><i class="fa fa-check"></i><b>6.5</b> Adjustment</a></li>
<li class="chapter" data-level="6.6" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#exercise"><i class="fa fa-check"></i><b>6.6</b> Exercise</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Book for Quasi-Experimental Designs</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="instrumental-variable" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Instrumental Variable<a href="instrumental-variable.html#instrumental-variable" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this lab, we will use Card (1995) to see how we can use an instrumental variable (distance to the nearest college) to estimate the effect of schooling on wage.</p>
<div id="loading-data" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Loading Data<a href="instrumental-variable.html#loading-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Load Stata file:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="instrumental-variable.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb45-2"><a href="instrumental-variable.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(foreign)</span>
<span id="cb45-3"><a href="instrumental-variable.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb45-4"><a href="instrumental-variable.html#cb45-4" aria-hidden="true" tabindex="-1"></a>card.data<span class="ot">&lt;-</span><span class="fu">read.dta</span>(<span class="st">&quot;card.dta&quot;</span>) </span></code></pre></div>
<p>See the description of the data here: <a href="https://www.ssc.wisc.edu/~bhansen/econometrics/Card1995_description.pdf" class="uri">https://www.ssc.wisc.edu/~bhansen/econometrics/Card1995_description.pdf</a></p>
<p>Preview the data:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="instrumental-variable.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(card.data)</span>
<span id="cb46-2"><a href="instrumental-variable.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(card.data)</span></code></pre></div>
<pre><code>##   id nearc2 nearc4 educ age fatheduc motheduc weight momdad14 sinmom14 step14 reg661
## 1  2      0      0    7  29       NA       NA 158413        1        0      0      1
## 2  3      0      0   12  27        8        8 380166        1        0      0      1
## 3  4      0      0   12  34       14       12 367470        1        0      0      1
## 4  5      1      1   11  27       11       12 380166        1        0      0      0
## 5  6      1      1   12  34        8        7 367470        1        0      0      0
## 6  7      1      1   12  26        9       12 380166        1        0      0      0
##   reg662 reg663 reg664 reg665 reg666 reg667 reg668 reg669 south66 black smsa south
## 1      0      0      0      0      0      0      0      0       0     1    1     0
## 2      0      0      0      0      0      0      0      0       0     0    1     0
## 3      0      0      0      0      0      0      0      0       0     0    1     0
## 4      1      0      0      0      0      0      0      0       0     0    1     0
## 5      1      0      0      0      0      0      0      0       0     0    1     0
## 6      1      0      0      0      0      0      0      0       0     0    1     0
##   smsa66 wage enroll kww  iq married libcrd14 exper    lwage expersq
## 1      1  548      0  15  NA       1        0    16 6.306275     256
## 2      1  481      0  35  93       1        1     9 6.175867      81
## 3      1  721      0  42 103       1        1    16 6.580639     256
## 4      1  250      0  25  88       1        1    10 5.521461     100
## 5      1  729      0  34 108       1        0    16 6.591674     256
## 6      1  500      0  38  85       1        1     8 6.214608      64</code></pre>
</div>
<div id="setup" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Setup<a href="instrumental-variable.html#setup" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Treatment: educ (years of education)</li>
<li>Outcome: lwage (log_wage)</li>
<li>IV: nearc4 (whether live close to a four-year college or not)</li>
</ul>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="instrumental-variable.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs.panels</span>(card.data[,<span class="fu">c</span>(<span class="st">&#39;lwage&#39;</span>,<span class="st">&#39;educ&#39;</span>, <span class="st">&#39;nearc4&#39;</span>)])</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-230-1.png" width="672" /></p>
</div>
<div id="regression-approaches" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Regression Approaches<a href="instrumental-variable.html#regression-approaches" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="naive-regression-ols-estimate-with-treatment-only" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Naive Regression: OLS estimate with treatment only<a href="instrumental-variable.html#naive-regression-ols-estimate-with-treatment-only" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="instrumental-variable.html#cb49-1" aria-hidden="true" tabindex="-1"></a>m0<span class="ot">&lt;-</span><span class="fu">lm</span>(lwage<span class="sc">~</span>educ, <span class="at">data =</span> card.data)</span>
<span id="cb49-2"><a href="instrumental-variable.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m0)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = lwage ~ educ, data = card.data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.73799 -0.27764  0.02373  0.28839  1.46080 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  5.57088    0.03883  143.47   &lt;2e-16 ***
## educ         0.05209    0.00287   18.15   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.4214 on 3008 degrees of freedom
## Multiple R-squared:  0.09874,    Adjusted R-squared:  0.09844 
## F-statistic: 329.5 on 1 and 3008 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="regression-with-covariates" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Regression with covariates<a href="instrumental-variable.html#regression-with-covariates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We find education is SSD, but we can make the case that it is endogenous.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="instrumental-variable.html#cb51-1" aria-hidden="true" tabindex="-1"></a>m1<span class="ot">&lt;-</span><span class="fu">lm</span>(lwage<span class="sc">~</span>educ<span class="sc">+</span>exper<span class="sc">+</span>expersq<span class="sc">+</span>black<span class="sc">+</span>south<span class="sc">+</span>smsa<span class="sc">+</span>reg661<span class="sc">+</span>reg662<span class="sc">+</span>reg663<span class="sc">+</span></span>
<span id="cb51-2"><a href="instrumental-variable.html#cb51-2" aria-hidden="true" tabindex="-1"></a>         reg664<span class="sc">+</span>reg665<span class="sc">+</span>reg666<span class="sc">+</span>reg667<span class="sc">+</span>reg668<span class="sc">+</span>smsa66, <span class="at">data =</span> card.data)</span>
<span id="cb51-3"><a href="instrumental-variable.html#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = lwage ~ educ + exper + expersq + black + south + 
##     smsa + reg661 + reg662 + reg663 + reg664 + reg665 + reg666 + 
##     reg667 + reg668 + smsa66, data = card.data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.62326 -0.22141  0.02001  0.23932  1.33340 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  4.7393766  0.0715282  66.259  &lt; 2e-16 ***
## educ         0.0746933  0.0034983  21.351  &lt; 2e-16 ***
## exper        0.0848320  0.0066242  12.806  &lt; 2e-16 ***
## expersq     -0.0022870  0.0003166  -7.223 6.41e-13 ***
## black       -0.1990123  0.0182483 -10.906  &lt; 2e-16 ***
## south       -0.1479550  0.0259799  -5.695 1.35e-08 ***
## smsa         0.1363845  0.0201005   6.785 1.39e-11 ***
## reg661      -0.1185698  0.0388301  -3.054 0.002281 ** 
## reg662      -0.0222026  0.0282575  -0.786 0.432092    
## reg663       0.0259703  0.0273644   0.949 0.342670    
## reg664      -0.0634942  0.0356803  -1.780 0.075254 .  
## reg665       0.0094551  0.0361174   0.262 0.793503    
## reg666       0.0219476  0.0400984   0.547 0.584182    
## reg667      -0.0005887  0.0393793  -0.015 0.988073    
## reg668      -0.1750058  0.0463394  -3.777 0.000162 ***
## smsa66       0.0262417  0.0194477   1.349 0.177327    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3723 on 2994 degrees of freedom
## Multiple R-squared:  0.2998, Adjusted R-squared:  0.2963 
## F-statistic: 85.48 on 15 and 2994 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div id="iv-does-education-effect-wages-when-college-proximity-is-used-as-the-instrument" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> IV: Does education effect wages when college proximity is used as the instrument?<a href="instrumental-variable.html#iv-does-education-effect-wages-when-college-proximity-is-used-as-the-instrument" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Is college proximity an exogenous determinant of wages?</p>
<div id="stage-1-t-on-iv" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Stage 1: T on IV<a href="instrumental-variable.html#stage-1-t-on-iv" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="instrumental-variable.html#cb53-1" aria-hidden="true" tabindex="-1"></a>m2<span class="ot">&lt;-</span><span class="fu">lm</span>(educ<span class="sc">~</span>nearc4<span class="sc">+</span>exper<span class="sc">+</span>expersq<span class="sc">+</span>black<span class="sc">+</span>south<span class="sc">+</span>smsa<span class="sc">+</span>reg661<span class="sc">+</span>reg662<span class="sc">+</span>reg663<span class="sc">+</span></span>
<span id="cb53-2"><a href="instrumental-variable.html#cb53-2" aria-hidden="true" tabindex="-1"></a>         reg664<span class="sc">+</span>reg665<span class="sc">+</span>reg666<span class="sc">+</span>reg667<span class="sc">+</span>reg668<span class="sc">+</span>smsa66, <span class="at">data =</span> card.data)</span>
<span id="cb53-3"><a href="instrumental-variable.html#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = educ ~ nearc4 + exper + expersq + black + south + 
##     smsa + reg661 + reg662 + reg663 + reg664 + reg665 + reg666 + 
##     reg667 + reg668 + smsa66, data = card.data)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -7.545 -1.370 -0.091  1.278  6.239 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 16.8485239  0.2111222  79.805  &lt; 2e-16 ***
## nearc4       0.3198989  0.0878638   3.641 0.000276 ***
## exper       -0.4125334  0.0336996 -12.241  &lt; 2e-16 ***
## expersq      0.0008686  0.0016504   0.526 0.598728    
## black       -0.9355287  0.0937348  -9.981  &lt; 2e-16 ***
## south       -0.0516126  0.1354284  -0.381 0.703152    
## smsa         0.4021825  0.1048112   3.837 0.000127 ***
## reg661      -0.2102710  0.2024568  -1.039 0.299076    
## reg662      -0.2889073  0.1473395  -1.961 0.049992 *  
## reg663      -0.2382099  0.1426357  -1.670 0.095012 .  
## reg664      -0.0930890  0.1859827  -0.501 0.616742    
## reg665      -0.4828875  0.1881872  -2.566 0.010336 *  
## reg666      -0.5130857  0.2096352  -2.448 0.014442 *  
## reg667      -0.4270887  0.2056208  -2.077 0.037880 *  
## reg668       0.3136204  0.2416739   1.298 0.194490    
## smsa66       0.0254805  0.1057692   0.241 0.809644    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.941 on 2994 degrees of freedom
## Multiple R-squared:  0.4771, Adjusted R-squared:  0.4745 
## F-statistic: 182.1 on 15 and 2994 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Predicted part in T:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="instrumental-variable.html#cb55-1" aria-hidden="true" tabindex="-1"></a>educ_hat <span class="ot">=</span> <span class="fu">fitted</span>(m2)</span></code></pre></div>
<div id="test-of-weak-instrument---rejected" class="section level4 hasAnchor" number="4.4.1.1">
<h4><span class="header-section-number">4.4.1.1</span> test of weak instrument - rejected<a href="instrumental-variable.html#test-of-weak-instrument---rejected" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="instrumental-variable.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(m2, <span class="fu">c</span>(<span class="st">&quot;nearc4=0&quot;</span>))</span></code></pre></div>
<pre><code>## Linear hypothesis test
## 
## Hypothesis:
## nearc4 = 0
## 
## Model 1: restricted model
## Model 2: educ ~ nearc4 + exper + expersq + black + south + smsa + reg661 + 
##     reg662 + reg663 + reg664 + reg665 + reg666 + reg667 + reg668 + 
##     smsa66
## 
##   Res.Df   RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1   2995 11324                                  
## 2   2994 11274  1    49.917 13.256 0.0002763 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
</div>
<div id="stage-2-y-on-t_hat" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Stage 2: Y on T_hat<a href="instrumental-variable.html#stage-2-y-on-t_hat" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="instrumental-variable.html#cb58-1" aria-hidden="true" tabindex="-1"></a>m2b <span class="ot">=</span> <span class="fu">lm</span>(lwage<span class="sc">~</span> educ_hat<span class="sc">+</span>exper<span class="sc">+</span>expersq<span class="sc">+</span>black<span class="sc">+</span>south<span class="sc">+</span>smsa<span class="sc">+</span>reg661<span class="sc">+</span>reg662<span class="sc">+</span>reg663<span class="sc">+</span></span>
<span id="cb58-2"><a href="instrumental-variable.html#cb58-2" aria-hidden="true" tabindex="-1"></a>           reg664<span class="sc">+</span>reg665<span class="sc">+</span>reg666<span class="sc">+</span>reg667<span class="sc">+</span>reg668<span class="sc">+</span>smsa66, <span class="at">data =</span> card.data)</span>
<span id="cb58-3"><a href="instrumental-variable.html#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2b)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = lwage ~ educ_hat + exper + expersq + black + south + 
##     smsa + reg661 + reg662 + reg663 + reg664 + reg665 + reg666 + 
##     reg667 + reg668 + smsa66, data = card.data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.57387 -0.25161  0.01483  0.27229  1.38522 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  3.7739651  0.9612564   3.926 8.83e-05 ***
## educ_hat     0.1315038  0.0565103   2.327 0.020028 *  
## exper        0.1082711  0.0243243   4.451 8.85e-06 ***
## expersq     -0.0023349  0.0003429  -6.810 1.18e-11 ***
## black       -0.1467757  0.0554166  -2.649 0.008125 ** 
## south       -0.1446715  0.0280524  -5.157 2.67e-07 ***
## smsa         0.1118083  0.0325530   3.435 0.000601 ***
## reg661      -0.1078142  0.0429903  -2.508 0.012199 *  
## reg662      -0.0070465  0.0338333  -0.208 0.835032    
## reg663       0.0404445  0.0326749   1.238 0.215892    
## reg664      -0.0579172  0.0386641  -1.498 0.134250    
## reg665       0.0384577  0.0482596   0.797 0.425577    
## reg666       0.0550887  0.0541416   1.017 0.309001    
## reg667       0.0267580  0.0502027   0.533 0.594074    
## reg668      -0.1908912  0.0521383  -3.661 0.000255 ***
## smsa66       0.0185311  0.0222167   0.834 0.404286    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3993 on 2994 degrees of freedom
## Multiple R-squared:  0.1947, Adjusted R-squared:  0.1907 
## F-statistic: 48.25 on 15 and 2994 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="all-in-one-function-ivreg" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> All-in-one function ivreg():<a href="instrumental-variable.html#all-in-one-function-ivreg" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="instrumental-variable.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AER)</span>
<span id="cb60-2"><a href="instrumental-variable.html#cb60-2" aria-hidden="true" tabindex="-1"></a>m4<span class="ot">&lt;-</span><span class="fu">ivreg</span>(lwage<span class="sc">~</span>educ<span class="sc">+</span>exper<span class="sc">+</span>expersq<span class="sc">+</span>black<span class="sc">+</span>south<span class="sc">+</span>smsa<span class="sc">+</span>reg661<span class="sc">+</span>reg662<span class="sc">+</span>reg663<span class="sc">+</span></span>
<span id="cb60-3"><a href="instrumental-variable.html#cb60-3" aria-hidden="true" tabindex="-1"></a>            reg664<span class="sc">+</span>reg665<span class="sc">+</span>reg666<span class="sc">+</span>reg667<span class="sc">+</span>reg668<span class="sc">+</span>smsa66 <span class="sc">|</span> nearc4<span class="sc">+</span>exper<span class="sc">+</span>expersq<span class="sc">+</span>black<span class="sc">+</span>south<span class="sc">+</span>smsa<span class="sc">+</span>reg661<span class="sc">+</span>reg662<span class="sc">+</span>reg663<span class="sc">+</span></span>
<span id="cb60-4"><a href="instrumental-variable.html#cb60-4" aria-hidden="true" tabindex="-1"></a>            reg664<span class="sc">+</span>reg665<span class="sc">+</span>reg666<span class="sc">+</span>reg667<span class="sc">+</span>reg668<span class="sc">+</span>smsa66)</span></code></pre></div>
<ul>
<li>formula, instruments<br />
</li>
<li>formula specification(s) of the regression relationship and the instruments.</li>
<li>instruments is missing and formula has three parts as in y ~ x1 + x2 | z1 + z2 + z3 (recommended)</li>
</ul>
<p>Alternatively:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="instrumental-variable.html#cb61-1" aria-hidden="true" tabindex="-1"></a>m4<span class="ot">&lt;-</span><span class="fu">ivreg</span>(lwage<span class="sc">~</span>educ<span class="sc">+</span>exper<span class="sc">+</span>expersq<span class="sc">+</span>black<span class="sc">+</span>south<span class="sc">+</span>smsa<span class="sc">+</span>reg661<span class="sc">+</span>reg662<span class="sc">+</span>reg663<span class="sc">+</span></span>
<span id="cb61-2"><a href="instrumental-variable.html#cb61-2" aria-hidden="true" tabindex="-1"></a>            reg664<span class="sc">+</span>reg665<span class="sc">+</span>reg666<span class="sc">+</span>reg667<span class="sc">+</span>reg668<span class="sc">+</span>smsa66 <span class="sc">|</span> .<span class="sc">-</span>educ<span class="sc">+</span>nearc4)</span></code></pre></div>
<ul>
<li><p>to the left of |: outcome = lwage</p></li>
<li><p>to the left of |: variables = educ+exper+expersq+black+south+smsa+reg661+reg662+reg663+reg664+reg665+reg666+reg667+reg668+smsa66</p></li>
<li><p>to the right of |: variables = nearc4+exper+expersq+black+south+smsa+reg661+reg662+reg663+reg664+reg665+reg666+reg667+reg668+smsa66</p></li>
<li><p>to the right of |: outcome = educ</p></li>
<li><p>to the right of |: 1st stage of 2SLS</p></li>
<li><p>to the left of |: 2nd stage of 2SLS</p></li>
<li><p>â€˜.â€™ means all variables in the dataset besides the one to the left of lwage</p></li>
<li><ul>
<li>treatment variable</li>
</ul></li>
<li><ul>
<li>instrument</li>
</ul></li>
</ul>
<p>Test using sandwich standard errors:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="instrumental-variable.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m4, <span class="at">vcov =</span> sandwich, <span class="at">diagnostics =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## ivreg(formula = lwage ~ educ + exper + expersq + black + south + 
##     smsa + reg661 + reg662 + reg663 + reg664 + reg665 + reg666 + 
##     reg667 + reg668 + smsa66 | . - educ + nearc4)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.83164 -0.24075  0.02428  0.25208  1.42760 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  3.7739651  0.9174053   4.114 4.00e-05 ***
## educ         0.1315038  0.0539995   2.435 0.014938 *  
## exper        0.1082711  0.0233466   4.638 3.68e-06 ***
## expersq     -0.0023349  0.0003478  -6.713 2.27e-11 ***
## black       -0.1467757  0.0523622  -2.803 0.005094 ** 
## south       -0.1446715  0.0290653  -4.977 6.81e-07 ***
## smsa         0.1118083  0.0310619   3.600 0.000324 ***
## reg661      -0.1078142  0.0409668  -2.632 0.008538 ** 
## reg662      -0.0070465  0.0336994  -0.209 0.834387    
## reg663       0.0404445  0.0325208   1.244 0.213725    
## reg664      -0.0579172  0.0392106  -1.477 0.139759    
## reg665       0.0384577  0.0494675   0.777 0.436965    
## reg666       0.0550887  0.0521309   1.057 0.290716    
## reg667       0.0267580  0.0501066   0.534 0.593367    
## reg668      -0.1908912  0.0506897  -3.766 0.000169 ***
## smsa66       0.0185311  0.0205103   0.904 0.366333    
## 
## Diagnostic tests:
##                   df1  df2 statistic  p-value    
## Weak instruments    1 2994    14.214 0.000166 ***
## Wu-Hausman          1 2993     1.219 0.269649    
## Sargan              0   NA        NA       NA    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3883 on 2994 degrees of freedom
## Multiple R-Squared: 0.2382,  Adjusted R-squared: 0.2343 
## Wald test: 56.06 on 15 and 2994 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="diagnostic-tests" class="section level3 hasAnchor" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> Diagnostic tests:<a href="instrumental-variable.html#diagnostic-tests" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="instrumental-variable.html#cb64-1" aria-hidden="true" tabindex="-1"></a>                  df1  df2 statistic  p<span class="sc">-</span>value    </span>
<span id="cb64-2"><a href="instrumental-variable.html#cb64-2" aria-hidden="true" tabindex="-1"></a>Weak instruments    <span class="dv">1</span> <span class="dv">2994</span>    <span class="fl">14.214</span> <span class="fl">0.000166</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb64-3"><a href="instrumental-variable.html#cb64-3" aria-hidden="true" tabindex="-1"></a>Wu<span class="sc">-</span>Hausman          <span class="dv">1</span> <span class="dv">2993</span>     <span class="fl">1.219</span> <span class="fl">0.269649</span>    </span>
<span id="cb64-4"><a href="instrumental-variable.html#cb64-4" aria-hidden="true" tabindex="-1"></a>Sargan              <span class="dv">0</span>   <span class="cn">NA</span>        <span class="cn">NA</span>       <span class="cn">NA</span>    </span></code></pre></div>
<ul>
<li><p>Weak instruments means that the IV has a low correlation with the treatment variable. The null is that the IV is weak. If the null is rejected, so you can move forward with the assumption that the instrument is sufficiently strong.</p></li>
<li><p>Applied to 2SLS regression, the Wuâ€“Hausman test is a test of endogenity. If all of the regressors are exogenous, then both the OLS and 2SLS estimators are consistent, and the OLS estimator is more efficient, but if one or more regressors are endogenous, then the OLS estimator is inconsistent. A large test statistic and small p-value suggests that the OLS estimator is inconsistent and the 2SLS estimator is therefore to be preferred.</p></li>
</ul>
</div>
<div id="multiple-iv" class="section level3 hasAnchor" number="4.4.5">
<h3><span class="header-section-number">4.4.5</span> Multiple IV<a href="instrumental-variable.html#multiple-iv" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="instrumental-variable.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#m5&lt;-ivreg(lwage~educ | .-educ+nearc4+nearc2)</span></span>
<span id="cb65-2"><a href="instrumental-variable.html#cb65-2" aria-hidden="true" tabindex="-1"></a>m5<span class="ot">&lt;-</span><span class="fu">ivreg</span>(lwage<span class="sc">~</span>educ<span class="sc">+</span>exper<span class="sc">+</span>expersq<span class="sc">+</span>black<span class="sc">+</span>south<span class="sc">+</span>smsa<span class="sc">+</span>reg661<span class="sc">+</span>reg662<span class="sc">+</span>reg663<span class="sc">+</span>reg664<span class="sc">+</span>reg665<span class="sc">+</span>reg666<span class="sc">+</span>reg667<span class="sc">+</span>reg668<span class="sc">+</span>smsa66 <span class="sc">|</span> .<span class="sc">-</span>educ<span class="sc">+</span>nearc4<span class="sc">+</span>nearc2)</span>
<span id="cb65-3"><a href="instrumental-variable.html#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m5, <span class="at">vcov =</span> sandwich, <span class="at">diagnostics =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## ivreg(formula = lwage ~ educ + exper + expersq + black + south + 
##     smsa + reg661 + reg662 + reg663 + reg664 + reg665 + reg666 + 
##     reg667 + reg668 + smsa66 | . - educ + nearc4 + nearc2)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.93841 -0.25068  0.01932  0.26519  1.46998 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  3.3396868  0.8909170   3.749 0.000181 ***
## educ         0.1570594  0.0524127   2.997 0.002753 ** 
## exper        0.1188149  0.0228905   5.191 2.24e-07 ***
## expersq     -0.0023565  0.0003674  -6.414 1.64e-10 ***
## black       -0.1232778  0.0514904  -2.394 0.016718 *  
## south       -0.1431945  0.0301873  -4.744 2.20e-06 ***
## smsa         0.1007530  0.0313621   3.213 0.001329 ** 
## reg661      -0.1029760  0.0425755  -2.419 0.015637 *  
## reg662      -0.0002286  0.0345230  -0.007 0.994716    
## reg663       0.0469556  0.0335252   1.401 0.161435    
## reg664      -0.0554084  0.0408927  -1.355 0.175529    
## reg665       0.0515041  0.0506274   1.017 0.309085    
## reg666       0.0699968  0.0534531   1.309 0.190466    
## reg667       0.0390596  0.0514309   0.759 0.447639    
## reg668      -0.1980371  0.0522335  -3.791 0.000153 ***
## smsa66       0.0150626  0.0211120   0.713 0.475616    
## 
## Diagnostic tests:
##                   df1  df2 statistic  p-value    
## Weak instruments    2 2993     8.366 0.000238 ***
## Wu-Hausman          1 2993     2.978 0.084509 .  
## Sargan              1   NA     1.248 0.263905    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.4053 on 2994 degrees of freedom
## Multiple R-Squared: 0.1702,  Adjusted R-squared: 0.166 
## Wald test: 51.65 on 15 and 2994 DF,  p-value: &lt; 2.2e-16</code></pre>
<ul>
<li>Sargan tests overidentification restrictions. The idea is that if you have more than one instrument per endogenous variable, the model is overidentified, and you have some excess information. All of the instruments must be valid for the inferences to be correct. So it tests that all exogenous instruments are in fact exogenous, and uncorrelated with the model residuals. If it is significant, it means that you donâ€™t have valid instruments (somewhere in there, as this is a global test). If it is not significant (our case), this isnâ€™t a concern.</li>
</ul>
</div>
<div id="compare-with-ols" class="section level3 hasAnchor" number="4.4.6">
<h3><span class="header-section-number">4.4.6</span> Compare with OLS:<a href="instrumental-variable.html#compare-with-ols" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="instrumental-variable.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span>
<span id="cb67-2"><a href="instrumental-variable.html#cb67-2" aria-hidden="true" tabindex="-1"></a>stargazer<span class="sc">::</span><span class="fu">stargazer</span>(m0, m1, m2b, m4, </span>
<span id="cb67-3"><a href="instrumental-variable.html#cb67-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type =</span> <span class="st">&#39;text&#39;</span>, <span class="at">model.names =</span> <span class="cn">FALSE</span>, </span>
<span id="cb67-4"><a href="instrumental-variable.html#cb67-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">column.labels =</span> <span class="fu">c</span>(<span class="st">&#39;Naive&#39;</span>, <span class="st">&#39;OLS&#39;</span>, <span class="st">&#39;2SLS&#39;</span>, <span class="st">&#39;IV&#39;</span>), </span>
<span id="cb67-5"><a href="instrumental-variable.html#cb67-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">column.sep.width =</span> <span class="st">&quot;15pt&quot;</span>, </span>
<span id="cb67-6"><a href="instrumental-variable.html#cb67-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">omit.stat =</span> <span class="fu">c</span>(<span class="st">&quot;f&quot;</span>, <span class="st">&quot;ser&quot;</span>))</span></code></pre></div>
<pre><code>## 
## ===================================================
##                       Dependent variable:          
##              --------------------------------------
##                              lwage                 
##               Naive      OLS      2SLS       IV    
##                (1)       (2)       (3)       (4)   
## ---------------------------------------------------
## educ         0.052*** 0.075***             0.132** 
##              (0.003)   (0.003)             (0.055) 
##                                                    
## educ_hat                         0.132**           
##                                  (0.057)           
##                                                    
## exper                 0.085***  0.108***  0.108*** 
##                        (0.007)   (0.024)   (0.024) 
##                                                    
## expersq               -0.002*** -0.002*** -0.002***
##                       (0.0003)  (0.0003)  (0.0003) 
##                                                    
## black                 -0.199*** -0.147*** -0.147***
##                        (0.018)   (0.055)   (0.054) 
##                                                    
## south                 -0.148*** -0.145*** -0.145***
##                        (0.026)   (0.028)   (0.027) 
##                                                    
## smsa                  0.136***  0.112***  0.112*** 
##                        (0.020)   (0.033)   (0.032) 
##                                                    
## reg661                -0.119*** -0.108**  -0.108***
##                        (0.039)   (0.043)   (0.042) 
##                                                    
## reg662                 -0.022    -0.007    -0.007  
##                        (0.028)   (0.034)   (0.033) 
##                                                    
## reg663                  0.026     0.040     0.040  
##                        (0.027)   (0.033)   (0.032) 
##                                                    
## reg664                 -0.063*   -0.058    -0.058  
##                        (0.036)   (0.039)   (0.038) 
##                                                    
## reg665                  0.009     0.038     0.038  
##                        (0.036)   (0.048)   (0.047) 
##                                                    
## reg666                  0.022     0.055     0.055  
##                        (0.040)   (0.054)   (0.053) 
##                                                    
## reg667                 -0.001     0.027     0.027  
##                        (0.039)   (0.050)   (0.049) 
##                                                    
## reg668                -0.175*** -0.191*** -0.191***
##                        (0.046)   (0.052)   (0.051) 
##                                                    
## smsa66                  0.026     0.019     0.019  
##                        (0.019)   (0.022)   (0.022) 
##                                                    
## Constant     5.571*** 4.739***  3.774***  3.774*** 
##              (0.039)   (0.072)   (0.961)   (0.935) 
##                                                    
## ---------------------------------------------------
## Observations  3,010     3,010     3,010     3,010  
## R2            0.099     0.300     0.195     0.238  
## Adjusted R2   0.098     0.296     0.191     0.234  
## ===================================================
## Note:                   *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
</div>
<div id="take-home-exercise" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Take-home exercise<a href="instrumental-variable.html#take-home-exercise" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="does-cigarette-smoking-have-an-effect-on-child-birth-weight-wooldridge-2002" class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> Does cigarette smoking have an effect on child birth weight (Wooldridge, 2002)?<a href="instrumental-variable.html#does-cigarette-smoking-have-an-effect-on-child-birth-weight-wooldridge-2002" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="instrumental-variable.html#cb69-1" aria-hidden="true" tabindex="-1"></a>bwght<span class="ot">&lt;-</span><span class="fu">read.dta</span>(<span class="st">&quot;bwght.dta&quot;</span>)</span>
<span id="cb69-2"><a href="instrumental-variable.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bwght)</span></code></pre></div>
<pre><code>##   faminc cigtax cigprice bwght fatheduc motheduc parity male white cigs   lbwght
## 1   13.5   16.5    122.3   109       12       12      1    1     1    0 4.691348
## 2    7.5   16.5    122.3   133        6       12      2    1     0    0 4.890349
## 3    0.5   16.5    122.3   129       NA       12      2    0     0    0 4.859812
## 4   15.5   16.5    122.3   126       12       12      2    1     0    0 4.836282
## 5   27.5   16.5    122.3   134       14       12      2    1     1    0 4.897840
## 6    7.5   16.5    122.3   118       12       14      6    1     0    0 4.770685
##   bwghtlbs packs    lfaminc
## 1   6.8125     0  2.6026897
## 2   8.3125     0  2.0149031
## 3   8.0625     0 -0.6931472
## 4   7.8750     0  2.7408400
## 5   8.3750     0  3.3141861
## 6   7.3750     0  2.0149031</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="instrumental-variable.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(bwght)</span></code></pre></div>
</div>
<div id="missing-data" class="section level3 hasAnchor" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> Missing data<a href="instrumental-variable.html#missing-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="instrumental-variable.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">apply</span>(bwght, <span class="dv">2</span>, is.na))</span></code></pre></div>
<pre><code>##   faminc   cigtax cigprice    bwght fatheduc motheduc   parity     male    white 
##        0        0        0        0      196        1        0        0        0 
##     cigs   lbwght bwghtlbs    packs  lfaminc 
##        0        0        0        0        0</code></pre>
<ul>
<li><a href="https://rdrr.io/cran/wooldridge/man/bwght.html" class="uri">https://rdrr.io/cran/wooldridge/man/bwght.html</a></li>
<li>A data.frame with 1388 observations on 14 variables:</li>
<li>cigtax: cig. tax in home state, 1988</li>
<li>cigprice: cig. price in home state, 1988 (tax already included)</li>
<li>faminc: 1988 family income, $1000s</li>
<li>lfaminc: log(faminc)</li>
<li>fatheduc: fatherâ€™s yrs of educ</li>
<li>motheduc: motherâ€™s yrs of educ</li>
<li>parity: birth order of child</li>
<li>male: =1 if male child</li>
<li>white: =1 if white</li>
<li>cigs: cigs smked per day while preg</li>
<li>packs: packs smked per day while preg</li>
<li>lbwght: log of bwght</li>
<li>bwghtlbs: birth weight, pounds</li>
<li>bwght: birth weight, ounces</li>
</ul>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="instrumental-variable.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb74-2"><a href="instrumental-variable.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs.panels</span>(bwght[,<span class="fu">c</span>(<span class="st">&#39;faminc&#39;</span>,<span class="st">&#39;lfaminc&#39;</span>)]) <span class="co"># lfaminc is better</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-245-1.png" width="672" /></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="instrumental-variable.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs.panels</span>(bwght[,<span class="fu">c</span>(<span class="st">&#39;cigs&#39;</span>,<span class="st">&#39;packs&#39;</span>)]) <span class="co"># same, go with cigs</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-245-2.png" width="672" /></p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="instrumental-variable.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs.panels</span>(bwght[,<span class="fu">c</span>(<span class="st">&#39;lbwght&#39;</span>,<span class="st">&#39;bwghtlbs&#39;</span>, <span class="st">&#39;bwght&#39;</span>)]) <span class="co"># any is good, go with bwghtlbs</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-245-3.png" width="672" /></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="instrumental-variable.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs.panels</span>(bwght[,<span class="fu">c</span>(<span class="st">&#39;cigs&#39;</span>,<span class="st">&#39;bwghtlbs&#39;</span>, <span class="st">&#39;cigprice&#39;</span>)]) <span class="co"># low correlations</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-245-4.png" width="672" /></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="instrumental-variable.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs.panels</span>(bwght[,<span class="fu">c</span>(<span class="st">&#39;cigs&#39;</span>,<span class="st">&#39;bwghtlbs&#39;</span>, <span class="st">&#39;cigprice&#39;</span>, <span class="st">&#39;lfaminc&#39;</span>, <span class="st">&#39;fatheduc&#39;</span>, <span class="st">&#39;motheduc&#39;</span>, <span class="st">&#39;parity&#39;</span>, <span class="st">&#39;male&#39;</span>, <span class="st">&#39;white&#39;</span>)])</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-245-5.png" width="672" /></p>
</div>
<div id="your-turn-now" class="section level3 hasAnchor" number="4.5.3">
<h3><span class="header-section-number">4.5.3</span> Your turn now!!!!<a href="instrumental-variable.html#your-turn-now" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="naive-regression-ols-estimate-with-treatment-only-1" class="section level3 hasAnchor" number="4.5.4">
<h3><span class="header-section-number">4.5.4</span> Naive Regression: OLS Estimate with treatment only<a href="instrumental-variable.html#naive-regression-ols-estimate-with-treatment-only-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="instrumental-variable.html#cb79-1" aria-hidden="true" tabindex="-1"></a>m0<span class="ot">&lt;-</span><span class="fu">lm</span>(bwghtlbs <span class="sc">~</span> cigs, <span class="at">data =</span> bwght)</span>
<span id="cb79-2"><a href="instrumental-variable.html#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m0)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = bwghtlbs ~ cigs, data = bwght)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -6.0482 -0.7357  0.0186  0.8268  9.4518 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  7.485744   0.035771 209.267  &lt; 2e-16 ***
## cigs        -0.032111   0.005656  -5.678 1.66e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.258 on 1386 degrees of freedom
## Multiple R-squared:  0.02273,    Adjusted R-squared:  0.02202 
## F-statistic: 32.24 on 1 and 1386 DF,  p-value: 1.662e-08</code></pre>
</div>
<div id="regression-with-covariates-1" class="section level3 hasAnchor" number="4.5.5">
<h3><span class="header-section-number">4.5.5</span> Regression with covariates<a href="instrumental-variable.html#regression-with-covariates-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="instrumental-variable.html#cb81-1" aria-hidden="true" tabindex="-1"></a>m1<span class="ot">&lt;-</span><span class="fu">lm</span>(bwghtlbs <span class="sc">~</span> cigs<span class="sc">+</span>lfaminc<span class="sc">+</span>fatheduc<span class="sc">+</span>motheduc<span class="sc">+</span>parity<span class="sc">+</span>male<span class="sc">+</span>white, <span class="at">data =</span> bwght)</span>
<span id="cb81-2"><a href="instrumental-variable.html#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = bwghtlbs ~ cigs + lfaminc + fatheduc + motheduc + 
##     parity + male + white, data = bwght)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.8763 -0.7293  0.0241  0.7912  9.5145 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  6.658642   0.254769  26.136  &lt; 2e-16 ***
## cigs        -0.037336   0.006856  -5.446 6.27e-08 ***
## lfaminc      0.076288   0.057027   1.338 0.181234    
## fatheduc     0.025947   0.017417   1.490 0.136565    
## motheduc    -0.021047   0.019852  -1.060 0.289270    
## parity       0.119845   0.040955   2.926 0.003496 ** 
## male         0.239041   0.071462   3.345 0.000849 ***
## white        0.289841   0.100741   2.877 0.004085 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.228 on 1183 degrees of freedom
##   (197 observations deleted due to missingness)
## Multiple R-squared:  0.05444,    Adjusted R-squared:  0.04885 
## F-statistic: 9.731 on 7 and 1183 DF,  p-value: 7.985e-12</code></pre>
<div id="test-of-weak-instrument---rejected-1" class="section level4 hasAnchor" number="4.5.5.1">
<h4><span class="header-section-number">4.5.5.1</span> test of weak instrument - rejected<a href="instrumental-variable.html#test-of-weak-instrument---rejected-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="instrumental-variable.html#cb83-1" aria-hidden="true" tabindex="-1"></a>m2<span class="ot">&lt;-</span><span class="fu">lm</span>(cigs <span class="sc">~</span> cigprice<span class="sc">+</span>lfaminc<span class="sc">+</span>fatheduc<span class="sc">+</span>motheduc<span class="sc">+</span>parity<span class="sc">+</span>male<span class="sc">+</span>white, <span class="at">data =</span> bwght)</span>
<span id="cb83-2"><a href="instrumental-variable.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = cigs ~ cigprice + lfaminc + fatheduc + motheduc + 
##     parity + male + white, data = bwght)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -6.509 -2.309 -1.466 -0.148 37.113 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  7.13393    2.09009   3.413 0.000664 ***
## cigprice     0.01366    0.01473   0.928 0.353749    
## lfaminc     -0.55819    0.24177  -2.309 0.021129 *  
## fatheduc    -0.11362    0.07385  -1.538 0.124201    
## motheduc    -0.33481    0.08360  -4.005 6.58e-05 ***
## parity       0.13511    0.17357   0.778 0.436485    
## male        -0.37175    0.30303  -1.227 0.220151    
## white        0.64796    0.42747   1.516 0.129839    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.204 on 1183 degrees of freedom
##   (197 observations deleted due to missingness)
## Multiple R-squared:  0.05705,    Adjusted R-squared:  0.05147 
## F-statistic: 10.22 on 7 and 1183 DF,  p-value: 1.753e-12</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="instrumental-variable.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb85-2"><a href="instrumental-variable.html#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(m2, <span class="fu">c</span>(<span class="st">&quot;cigprice=0&quot;</span>))</span></code></pre></div>
<pre><code>## Linear hypothesis test
## 
## Hypothesis:
## cigprice = 0
## 
## Model 1: restricted model
## Model 2: cigs ~ cigprice + lfaminc + fatheduc + motheduc + parity + male + 
##     white
## 
##   Res.Df   RSS Df Sum of Sq      F Pr(&gt;F)
## 1   1184 32066                           
## 2   1183 32043  1    23.311 0.8606 0.3537</code></pre>
<ul>
<li>cigprice, tax included, penalizes the excessive use of cigarettes</li>
<li>although cigprice affects cigs, cigprice is not a strong instrument</li>
</ul>
</div>
</div>
<div id="iv-done-manually" class="section level3 hasAnchor" number="4.5.6">
<h3><span class="header-section-number">4.5.6</span> IV done manually<a href="instrumental-variable.html#iv-done-manually" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="instrumental-variable.html#cb87-1" aria-hidden="true" tabindex="-1"></a>bwght.comp <span class="ot">=</span> <span class="fu">na.omit</span>(bwght)</span>
<span id="cb87-2"><a href="instrumental-variable.html#cb87-2" aria-hidden="true" tabindex="-1"></a>bwght.comp<span class="sc">$</span>cig_hat <span class="ot">=</span> <span class="fu">fitted</span>(m2)</span>
<span id="cb87-3"><a href="instrumental-variable.html#cb87-3" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">=</span> <span class="fu">lm</span>(bwghtlbs <span class="sc">~</span> cig_hat<span class="sc">+</span>lfaminc<span class="sc">+</span>fatheduc<span class="sc">+</span>motheduc<span class="sc">+</span>parity<span class="sc">+</span>male<span class="sc">+</span>white, <span class="at">data =</span> bwght.comp)</span>
<span id="cb87-4"><a href="instrumental-variable.html#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m3)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = bwghtlbs ~ cig_hat + lfaminc + fatheduc + motheduc + 
##     parity + male + white, data = bwght.comp)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.8116 -0.7267  0.0585  0.8156  9.5607 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)  4.67348    2.28159   2.048  0.04075 * 
## cig_hat      0.18797    0.25739   0.730  0.46534   
## lfaminc      0.19868    0.15122   1.314  0.18915   
## fatheduc     0.05079    0.03340   1.521  0.12863   
## motheduc     0.05459    0.08869   0.616  0.53828   
## parity       0.08942    0.05409   1.653  0.09855 . 
## male         0.32012    0.11750   2.724  0.00654 **
## white        0.13817    0.20099   0.687  0.49193   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.243 on 1183 degrees of freedom
## Multiple R-squared:  0.03118,    Adjusted R-squared:  0.02544 
## F-statistic: 5.439 on 7 and 1183 DF,  p-value: 3.691e-06</code></pre>
<p>same coefficients with ivreg(), but incorrect standard errors</p>
</div>
<div id="ivreg" class="section level3 hasAnchor" number="4.5.7">
<h3><span class="header-section-number">4.5.7</span> IVreg()<a href="instrumental-variable.html#ivreg" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="instrumental-variable.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AER)</span>
<span id="cb89-2"><a href="instrumental-variable.html#cb89-2" aria-hidden="true" tabindex="-1"></a>m4<span class="ot">&lt;-</span><span class="fu">ivreg</span>(bwghtlbs <span class="sc">~</span> cigs<span class="sc">+</span>lfaminc<span class="sc">+</span>fatheduc<span class="sc">+</span>motheduc<span class="sc">+</span>parity<span class="sc">+</span>male<span class="sc">+</span>white <span class="sc">|</span> .<span class="sc">-</span>cigs<span class="sc">+</span>cigprice)</span>
<span id="cb89-3"><a href="instrumental-variable.html#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m4, <span class="at">vcov =</span> sandwich, <span class="at">diagnostics =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## ivreg(formula = bwghtlbs ~ cigs + lfaminc + fatheduc + motheduc + 
##     parity + male + white | . - cigs + cigprice)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -9.5996 -0.7003  0.2125  1.1268  9.8161 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)  4.67348    3.03351   1.541   0.1237  
## cigs         0.18797    0.34402   0.546   0.5849  
## lfaminc      0.19868    0.19853   1.001   0.3172  
## fatheduc     0.05079    0.04496   1.130   0.2588  
## motheduc     0.05459    0.11806   0.462   0.6439  
## parity       0.08942    0.07452   1.200   0.2304  
## male         0.32012    0.15398   2.079   0.0378 *
## white        0.13817    0.27141   0.509   0.6108  
## 
## Diagnostic tests:
##                   df1  df2 statistic p-value
## Weak instruments    1 1183     0.914   0.339
## Wu-Hausman          1 1182     0.825   0.364
## Sargan              0   NA        NA      NA
## 
## Residual standard error: 1.698 on 1183 degrees of freedom
## Multiple R-Squared: -0.8088, Adjusted R-squared: -0.8195 
## Wald test:     3 on 7 and 1183 DF,  p-value: 0.003982</code></pre>
</div>
<div id="model-comparison" class="section level3 hasAnchor" number="4.5.8">
<h3><span class="header-section-number">4.5.8</span> Model Comparison<a href="instrumental-variable.html#model-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="instrumental-variable.html#cb91-1" aria-hidden="true" tabindex="-1"></a>stargazer<span class="sc">::</span><span class="fu">stargazer</span>(m0, m1, m3, m4, </span>
<span id="cb91-2"><a href="instrumental-variable.html#cb91-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type =</span> <span class="st">&#39;text&#39;</span>, <span class="at">model.names =</span> <span class="cn">FALSE</span>, </span>
<span id="cb91-3"><a href="instrumental-variable.html#cb91-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">column.labels =</span> <span class="fu">c</span>(<span class="st">&#39;Naive&#39;</span>, <span class="st">&#39;OLS&#39;</span>, <span class="st">&#39;2SLS&#39;</span>, <span class="st">&#39;IV&#39;</span>), </span>
<span id="cb91-4"><a href="instrumental-variable.html#cb91-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">column.sep.width =</span> <span class="st">&quot;15pt&quot;</span>, </span>
<span id="cb91-5"><a href="instrumental-variable.html#cb91-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">omit.stat =</span> <span class="fu">c</span>(<span class="st">&quot;f&quot;</span>, <span class="st">&quot;ser&quot;</span>))</span></code></pre></div>
<pre><code>## 
## =================================================
##                      Dependent variable:         
##              ------------------------------------
##                            bwghtlbs              
##                Naive      OLS      2SLS     IV   
##                 (1)       (2)      (3)      (4)  
## -------------------------------------------------
## cigs         -0.032*** -0.037***           0.188 
##               (0.006)   (0.007)           (0.352)
##                                                  
## cig_hat                           0.188          
##                                  (0.257)         
##                                                  
## lfaminc                  0.076    0.199    0.199 
##                         (0.057)  (0.151)  (0.207)
##                                                  
## fatheduc                 0.026    0.051    0.051 
##                         (0.017)  (0.033)  (0.046)
##                                                  
## motheduc                -0.021    0.055    0.055 
##                         (0.020)  (0.089)  (0.121)
##                                                  
## parity                 0.120***   0.089*   0.089 
##                         (0.041)  (0.054)  (0.074)
##                                                  
## male                   0.239***  0.320*** 0.320**
##                         (0.071)  (0.117)  (0.161)
##                                                  
## white                  0.290***   0.138    0.138 
##                         (0.101)  (0.201)  (0.275)
##                                                  
## Constant     7.486***  6.659***  4.673**   4.673 
##               (0.036)   (0.255)  (2.282)  (3.118)
##                                                  
## -------------------------------------------------
## Observations   1,388     1,191    1,191    1,191 
## R2             0.023     0.054    0.031   -0.809 
## Adjusted R2    0.022     0.049    0.025   -0.819 
## =================================================
## Note:                 *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
<ul>
<li><p>Since cigprice is NOT a good instrument, we will favor m2 (OLS) over m4 in this case.</p></li>
<li><p>Negative R2?</p></li>
<li><p><a href="https://www.stata.com/support/faqs/statistics/two-stage-least-squares/#" class="uri">https://www.stata.com/support/faqs/statistics/two-stage-least-squares/#</a>:~:text=Stataâ€™s%20ivregress%20command%20suppresses%20the,the%20context%20of%202SLS%2FIV.</p></li>
<li><p>Missing R2s, negative R2s, and negative model sum of squares are all the same issue.</p></li>
<li><p>However, since our goal is to estimate the structural model, the actual values, not the instruments for the endogenous right-hand-side variables, are used to determine the model sum of squares (MSS).</p></li>
<li><p>This means a constant-only model of the dependent variable is NOT nested within the two-stage least-squares model, even though the two-stage model estimates an intercept, and the residual sum of squares (RSS) is no longer constrained to be smaller than the total sum of squares (TSS).</p></li>
<li><p>ybar is a better predictor of y (in the sum-of-squares sense) than Xb!</p></li>
<li><p>Is that a problem? You can easily develop simulations where the parameter estimates from two-stage are quite good while the MSS is negative.</p></li>
<li><p>If our two-stage model produces estimates of these parameters with acceptable standard errors, we should be happyâ€”regardless of MSS or R2.</p></li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="types-of-causal-effects.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="psm-matching-strategy.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/YOUR GITHUB USERNAME/YOUR REPO NAME/edit/master/04-IV-Estimation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/YOUR GITHUB USERNAME/YOUR REPO NAME/blob/master/04-IV-Estimation.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
