<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Simple DID estimator | R Book for Quasi-Experimental Designs</title>
  <meta name="description" content="Chapter 7 Simple DID estimator | R Book for Quasi-Experimental Designs" />
  <meta name="generator" content="bookdown 0.28 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Simple DID estimator | R Book for Quasi-Experimental Designs" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Simple DID estimator | R Book for Quasi-Experimental Designs" />
  
  
  

<meta name="author" content="Ge Jiang" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="propensity-score-analysis.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R for Quasi-exp Designs</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Course</a></li>
<li class="chapter" data-level="2" data-path="regression-approach-to-treatment-effect-estimation.html"><a href="regression-approach-to-treatment-effect-estimation.html"><i class="fa fa-check"></i><b>2</b> Regression Approach to Treatment Effect Estimation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="regression-approach-to-treatment-effect-estimation.html"><a href="regression-approach-to-treatment-effect-estimation.html#regression-w-no-confounder"><i class="fa fa-check"></i><b>2.1</b> Regression w/ no confounder</a></li>
<li class="chapter" data-level="2.2" data-path="regression-approach-to-treatment-effect-estimation.html"><a href="regression-approach-to-treatment-effect-estimation.html#including-confounder-ses"><i class="fa fa-check"></i><b>2.2</b> Including confounder SES</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="regression-approach-to-treatment-effect-estimation.html"><a href="regression-approach-to-treatment-effect-estimation.html#low-ses"><i class="fa fa-check"></i><b>2.2.1</b> low SES</a></li>
<li class="chapter" data-level="2.2.2" data-path="regression-approach-to-treatment-effect-estimation.html"><a href="regression-approach-to-treatment-effect-estimation.html#middle-ses"><i class="fa fa-check"></i><b>2.2.2</b> middle SES</a></li>
<li class="chapter" data-level="2.2.3" data-path="regression-approach-to-treatment-effect-estimation.html"><a href="regression-approach-to-treatment-effect-estimation.html#high-ses"><i class="fa fa-check"></i><b>2.2.3</b> high SES</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="types-of-causal-effects.html"><a href="types-of-causal-effects.html"><i class="fa fa-check"></i><b>3</b> Types of Causal Effects</a>
<ul>
<li class="chapter" data-level="3.1" data-path="types-of-causal-effects.html"><a href="types-of-causal-effects.html#att-ate-atu-what-the-what"><i class="fa fa-check"></i><b>3.1</b> ATT, ATE, ATU, … what the what?</a></li>
<li class="chapter" data-level="3.2" data-path="types-of-causal-effects.html"><a href="types-of-causal-effects.html#calculating-different-causal-effects-in-practice"><i class="fa fa-check"></i><b>3.2</b> Calculating different causal effects in practice</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="instrumental-variable.html"><a href="instrumental-variable.html"><i class="fa fa-check"></i><b>4</b> Instrumental Variable</a>
<ul>
<li class="chapter" data-level="4.1" data-path="instrumental-variable.html"><a href="instrumental-variable.html#loading-data"><i class="fa fa-check"></i><b>4.1</b> Loading Data</a></li>
<li class="chapter" data-level="4.2" data-path="instrumental-variable.html"><a href="instrumental-variable.html#setup"><i class="fa fa-check"></i><b>4.2</b> Setup</a></li>
<li class="chapter" data-level="4.3" data-path="instrumental-variable.html"><a href="instrumental-variable.html#regression-approaches"><i class="fa fa-check"></i><b>4.3</b> Regression Approaches</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="instrumental-variable.html"><a href="instrumental-variable.html#naive-regression-ols-estimate-with-treatment-only"><i class="fa fa-check"></i><b>4.3.1</b> Naive Regression: OLS estimate with treatment only</a></li>
<li class="chapter" data-level="4.3.2" data-path="instrumental-variable.html"><a href="instrumental-variable.html#regression-with-covariates"><i class="fa fa-check"></i><b>4.3.2</b> Regression with covariates</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="instrumental-variable.html"><a href="instrumental-variable.html#iv-does-education-effect-wages-when-college-proximity-is-used-as-the-instrument"><i class="fa fa-check"></i><b>4.4</b> IV: Does education effect wages when college proximity is used as the instrument?</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="instrumental-variable.html"><a href="instrumental-variable.html#stage-1-t-on-iv"><i class="fa fa-check"></i><b>4.4.1</b> Stage 1: T on IV</a></li>
<li class="chapter" data-level="4.4.2" data-path="instrumental-variable.html"><a href="instrumental-variable.html#stage-2-y-on-t_hat"><i class="fa fa-check"></i><b>4.4.2</b> Stage 2: Y on T_hat</a></li>
<li class="chapter" data-level="4.4.3" data-path="instrumental-variable.html"><a href="instrumental-variable.html#all-in-one-function-ivreg"><i class="fa fa-check"></i><b>4.4.3</b> All-in-one function ivreg():</a></li>
<li class="chapter" data-level="4.4.4" data-path="instrumental-variable.html"><a href="instrumental-variable.html#diagnostic-tests"><i class="fa fa-check"></i><b>4.4.4</b> Diagnostic tests:</a></li>
<li class="chapter" data-level="4.4.5" data-path="instrumental-variable.html"><a href="instrumental-variable.html#multiple-iv"><i class="fa fa-check"></i><b>4.4.5</b> Multiple IV</a></li>
<li class="chapter" data-level="4.4.6" data-path="instrumental-variable.html"><a href="instrumental-variable.html#compare-with-ols"><i class="fa fa-check"></i><b>4.4.6</b> Compare with OLS:</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="instrumental-variable.html"><a href="instrumental-variable.html#take-home-exercise"><i class="fa fa-check"></i><b>4.5</b> Take-home exercise</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="instrumental-variable.html"><a href="instrumental-variable.html#does-cigarette-smoking-have-an-effect-on-child-birth-weight-wooldridge-2002"><i class="fa fa-check"></i><b>4.5.1</b> Does cigarette smoking have an effect on child birth weight (Wooldridge, 2002)?</a></li>
<li class="chapter" data-level="4.5.2" data-path="instrumental-variable.html"><a href="instrumental-variable.html#missing-data"><i class="fa fa-check"></i><b>4.5.2</b> Missing data</a></li>
<li class="chapter" data-level="4.5.3" data-path="instrumental-variable.html"><a href="instrumental-variable.html#your-turn-now"><i class="fa fa-check"></i><b>4.5.3</b> Your turn now!!!!</a></li>
<li class="chapter" data-level="4.5.4" data-path="instrumental-variable.html"><a href="instrumental-variable.html#naive-regression-ols-estimate-with-treatment-only-1"><i class="fa fa-check"></i><b>4.5.4</b> Naive Regression: OLS Estimate with treatment only</a></li>
<li class="chapter" data-level="4.5.5" data-path="instrumental-variable.html"><a href="instrumental-variable.html#regression-with-covariates-1"><i class="fa fa-check"></i><b>4.5.5</b> Regression with covariates</a></li>
<li class="chapter" data-level="4.5.6" data-path="instrumental-variable.html"><a href="instrumental-variable.html#iv-done-manually"><i class="fa fa-check"></i><b>4.5.6</b> IV done manually</a></li>
<li class="chapter" data-level="4.5.7" data-path="instrumental-variable.html"><a href="instrumental-variable.html#ivreg"><i class="fa fa-check"></i><b>4.5.7</b> IVreg()</a></li>
<li class="chapter" data-level="4.5.8" data-path="instrumental-variable.html"><a href="instrumental-variable.html#model-comparison"><i class="fa fa-check"></i><b>4.5.8</b> Model Comparison</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html"><i class="fa fa-check"></i><b>5</b> PSM Matching Strategy</a>
<ul>
<li class="chapter" data-level="5.1" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#data"><i class="fa fa-check"></i><b>5.1</b> Data</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#create-dummy-variable-for-race-and-unemployment"><i class="fa fa-check"></i><b>5.1.1</b> Create dummy variable for race and unemployment</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#regression-estimates"><i class="fa fa-check"></i><b>5.2</b> Regression Estimates</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#naive-t-test-estimate"><i class="fa fa-check"></i><b>5.2.1</b> naive t-test estimate</a></li>
<li class="chapter" data-level="5.2.2" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#regression-with-covariates-2"><i class="fa fa-check"></i><b>5.2.2</b> regression with covariates</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#psm-steps"><i class="fa fa-check"></i><b>5.3</b> PSM Steps</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#selection-of-covariates-in-x"><i class="fa fa-check"></i><b>5.3.1</b> Selection of covariates in X</a></li>
<li class="chapter" data-level="5.3.2" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#calculation-of-propensity-scores-p-scores"><i class="fa fa-check"></i><b>5.3.2</b> Calculation of propensity scores (p-scores)</a></li>
<li class="chapter" data-level="5.3.3" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#matching-based-on-p-sores"><i class="fa fa-check"></i><b>5.3.3</b> Matching based on p-sores</a></li>
<li class="chapter" data-level="5.3.4" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#checking-balance-on-covariates"><i class="fa fa-check"></i><b>5.3.4</b> Checking balance on covariates:</a></li>
<li class="chapter" data-level="5.3.5" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#estimation-of-treatment-effect"><i class="fa fa-check"></i><b>5.3.5</b> Estimation of treatment effect</a></li>
<li class="chapter" data-level="5.3.6" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#hidden-bias-analysis"><i class="fa fa-check"></i><b>5.3.6</b> Hidden bias analysis</a></li>
<li class="chapter" data-level="5.3.7" data-path="psm-matching-strategy.html"><a href="psm-matching-strategy.html#references"><i class="fa fa-check"></i><b>5.3.7</b> References:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html"><i class="fa fa-check"></i><b>6</b> Propensity Score Analysis</a>
<ul>
<li class="chapter" data-level="6.1" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#data-1"><i class="fa fa-check"></i><b>6.1</b> Data</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#create-dummy-variable-for-race-and-unemployment-1"><i class="fa fa-check"></i><b>6.1.1</b> Create dummy variable for race and unemployment</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#calculating-propensity-scores"><i class="fa fa-check"></i><b>6.2</b> Calculating Propensity Scores</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#different-formulas"><i class="fa fa-check"></i><b>6.2.1</b> Different formulas</a></li>
<li class="chapter" data-level="6.2.2" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#calculation-of-propensity-scores-p-scores-1"><i class="fa fa-check"></i><b>6.2.2</b> Calculation of propensity scores (p-scores)</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#iptw-inverse-probability-treatment-weighting"><i class="fa fa-check"></i><b>6.3</b> IPTW: Inverse Probability Treatment Weighting</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#weightatt"><i class="fa fa-check"></i><b>6.3.1</b> weightATT</a></li>
<li class="chapter" data-level="6.3.2" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#weightate"><i class="fa fa-check"></i><b>6.3.2</b> weightATE</a></li>
<li class="chapter" data-level="6.3.3" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#weight-truncation"><i class="fa fa-check"></i><b>6.3.3</b> Weight truncation</a></li>
<li class="chapter" data-level="6.3.4" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#balance-check"><i class="fa fa-check"></i><b>6.3.4</b> Balance check</a></li>
<li class="chapter" data-level="6.3.5" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#estimation-of-treatment-effect-1"><i class="fa fa-check"></i><b>6.3.5</b> Estimation of treatment effect</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#stratification"><i class="fa fa-check"></i><b>6.4</b> Stratification</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#manually-creating-subclasses"><i class="fa fa-check"></i><b>6.4.1</b> Manually creating subclasses</a></li>
<li class="chapter" data-level="6.4.2" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#stratification-using-matchit"><i class="fa fa-check"></i><b>6.4.2</b> Stratification using matchit():</a></li>
<li class="chapter" data-level="6.4.3" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#covariate-balance-evaluation"><i class="fa fa-check"></i><b>6.4.3</b> Covariate Balance Evaluation</a></li>
<li class="chapter" data-level="6.4.4" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#calculate-the-stratum-weights"><i class="fa fa-check"></i><b>6.4.4</b> Calculate the stratum weights</a></li>
<li class="chapter" data-level="6.4.5" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#estimation-of-treatment-effects"><i class="fa fa-check"></i><b>6.4.5</b> Estimation of Treatment Effects</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#adjustment"><i class="fa fa-check"></i><b>6.5</b> Adjustment</a></li>
<li class="chapter" data-level="6.6" data-path="propensity-score-analysis.html"><a href="propensity-score-analysis.html#exercise"><i class="fa fa-check"></i><b>6.6</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="simple-did-estimator.html"><a href="simple-did-estimator.html"><i class="fa fa-check"></i><b>7</b> Simple DID estimator</a>
<ul>
<li class="chapter" data-level="7.1" data-path="simple-did-estimator.html"><a href="simple-did-estimator.html#data-2"><i class="fa fa-check"></i><b>7.1</b> Data</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="simple-did-estimator.html"><a href="simple-did-estimator.html#scatterplot-by-country"><i class="fa fa-check"></i><b>7.1.1</b> scatterplot by country:</a></li>
<li class="chapter" data-level="7.1.2" data-path="simple-did-estimator.html"><a href="simple-did-estimator.html#create-dummy-variables"><i class="fa fa-check"></i><b>7.1.2</b> Create dummy variables</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="simple-did-estimator.html"><a href="simple-did-estimator.html#the-did-estimator"><i class="fa fa-check"></i><b>7.2</b> The DID estimator</a></li>
<li class="chapter" data-level="7.3" data-path="simple-did-estimator.html"><a href="simple-did-estimator.html#card-and-krueger-1994-from-poedata"><i class="fa fa-check"></i><b>7.3</b> Card and Krueger (1994) from PoEdata</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="simple-did-estimator.html"><a href="simple-did-estimator.html#models"><i class="fa fa-check"></i><b>7.3.1</b> Models</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="simple-did-estimator.html"><a href="simple-did-estimator.html#optional-demo-of-honestdid-rambachan-roth-2022"><i class="fa fa-check"></i><b>7.4</b> Optional: Demo of HonestDiD (Rambachan &amp; Roth, 2022)</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="simple-did-estimator.html"><a href="simple-did-estimator.html#estimate-the-baseline-did"><i class="fa fa-check"></i><b>7.4.1</b> Estimate the baseline DiD</a></li>
<li class="chapter" data-level="7.4.2" data-path="simple-did-estimator.html"><a href="simple-did-estimator.html#sensitivity-analysis-using-relative-magnitudes-restrictions"><i class="fa fa-check"></i><b>7.4.2</b> Sensitivity analysis using relative magnitudes restrictions</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="simple-did-estimator.html"><a href="simple-did-estimator.html#optional-synthetic-control"><i class="fa fa-check"></i><b>7.5</b> Optional: Synthetic Control</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="simple-did-estimator.html"><a href="simple-did-estimator.html#smoking-data"><i class="fa fa-check"></i><b>7.5.1</b> Smoking data</a></li>
<li class="chapter" data-level="7.5.2" data-path="simple-did-estimator.html"><a href="simple-did-estimator.html#generate-control"><i class="fa fa-check"></i><b>7.5.2</b> Generate Control</a></li>
<li class="chapter" data-level="7.5.3" data-path="simple-did-estimator.html"><a href="simple-did-estimator.html#inference"><i class="fa fa-check"></i><b>7.5.3</b> Inference</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Book for Quasi-Experimental Designs</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="simple-did-estimator" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Simple DID estimator<a href="simple-did-estimator.html#simple-did-estimator" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this lab, we will use propensity scores to perform other types of analyses (weighting, stratification, and covariate adjustment)</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="simple-did-estimator.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(foreign)</span>
<span id="cb1-2"><a href="simple-did-estimator.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb1-3"><a href="simple-did-estimator.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span>
<span id="cb1-4"><a href="simple-did-estimator.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#library(devtools)</span></span>
<span id="cb1-5"><a href="simple-did-estimator.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#devtools::install_github(&#39;ccolonescu/PoEdata&#39;)</span></span>
<span id="cb1-6"><a href="simple-did-estimator.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PoEdata)</span></code></pre></div>
<!------------------------------>
<div id="data-2" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Data<a href="simple-did-estimator.html#data-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!------------------------------>
<p>Getting sample data:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="simple-did-estimator.html#cb2-1" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">=</span> <span class="fu">read.dta</span>(<span class="st">&quot;http://dss.princeton.edu/training/Panel101.dta&quot;</span>)</span>
<span id="cb2-2"><a href="simple-did-estimator.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mydata)</span></code></pre></div>
<pre><code>##   country year           y y_bin        x1         x2          x3   opinion op
## 1       A 1990  1342787840     1 0.2779036 -1.1079559  0.28255358 Str agree  1
## 2       A 1991 -1899660544     0 0.3206847 -0.9487200  0.49253848     Disag  0
## 3       A 1992   -11234363     0 0.3634657 -0.7894840  0.70252335     Disag  0
## 4       A 1993  2645775360     1 0.2461440 -0.8855330 -0.09439092     Disag  0
## 5       A 1994  3008334848     1 0.4246230 -0.7297683  0.94613063     Disag  0
## 6       A 1995  3229574144     1 0.4772141 -0.7232460  1.02968037 Str agree  1</code></pre>
<div id="scatterplot-by-country" class="section level3 hasAnchor" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> scatterplot by country:<a href="simple-did-estimator.html#scatterplot-by-country" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="simple-did-estimator.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot</span>(y<span class="sc">~</span>year<span class="sc">|</span>country, <span class="at">boxplots=</span><span class="cn">FALSE</span>, <span class="at">smooth=</span><span class="cn">TRUE</span>, <span class="at">data =</span> mydata)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
<div id="create-dummy-variables" class="section level3 hasAnchor" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> Create dummy variables<a href="simple-did-estimator.html#create-dummy-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>time: time when the treatment started</li>
</ol>
<p>Let’s assume that treatment started in 1994. In this case, years before 1994 will have a value of 0 and 1994+ a 1. If you already have this skip this step.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="simple-did-estimator.html#cb5-1" aria-hidden="true" tabindex="-1"></a>mydata<span class="sc">$</span>time <span class="ot">=</span> <span class="fu">ifelse</span>(mydata<span class="sc">$</span>year <span class="sc">&gt;=</span> <span class="dv">1994</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code></pre></div>
<p>2.treated: the group exposed to the treatment</p>
<ul>
<li>In this example let’s assumed that countries with code 5,6, and 7 were treated (=1).</li>
<li>Countries 1-4 were not treated (=0). If you already have this skip this step.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="simple-did-estimator.html#cb6-1" aria-hidden="true" tabindex="-1"></a>mydata<span class="sc">$</span>treated <span class="ot">=</span> <span class="fu">ifelse</span>(mydata<span class="sc">$</span>country <span class="sc">==</span> <span class="st">&quot;E&quot;</span> <span class="sc">|</span></span>
<span id="cb6-2"><a href="simple-did-estimator.html#cb6-2" aria-hidden="true" tabindex="-1"></a>                          mydata<span class="sc">$</span>country <span class="sc">==</span> <span class="st">&quot;F&quot;</span> <span class="sc">|</span></span>
<span id="cb6-3"><a href="simple-did-estimator.html#cb6-3" aria-hidden="true" tabindex="-1"></a>                          mydata<span class="sc">$</span>country <span class="sc">==</span> <span class="st">&quot;G&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code></pre></div>
<p>3.did: an interaction by multiplying time and treated. We will call this interaction ‘did’.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="simple-did-estimator.html#cb7-1" aria-hidden="true" tabindex="-1"></a>mydata<span class="sc">$</span>did <span class="ot">=</span> mydata<span class="sc">$</span>time <span class="sc">*</span> mydata<span class="sc">$</span>treated</span></code></pre></div>
<!------------------------------>
</div>
</div>
<div id="the-did-estimator" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> The DID estimator<a href="simple-did-estimator.html#the-did-estimator" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!------------------------------>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="simple-did-estimator.html#cb8-1" aria-hidden="true" tabindex="-1"></a>didreg <span class="ot">=</span> <span class="fu">lm</span>(y <span class="sc">~</span> treated <span class="sc">+</span> time <span class="sc">+</span> did, <span class="at">data =</span> mydata)</span>
<span id="cb8-2"><a href="simple-did-estimator.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(didreg)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ treated + time + did, data = mydata)
## 
## Residuals:
##        Min         1Q     Median         3Q        Max 
## -9.768e+09 -1.623e+09  1.167e+08  1.393e+09  6.807e+09 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)  3.581e+08  7.382e+08   0.485   0.6292  
## treated      1.776e+09  1.128e+09   1.575   0.1200  
## time         2.289e+09  9.530e+08   2.402   0.0191 *
## did         -2.520e+09  1.456e+09  -1.731   0.0882 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.953e+09 on 66 degrees of freedom
## Multiple R-squared:  0.08273,    Adjusted R-squared:  0.04104 
## F-statistic: 1.984 on 3 and 66 DF,  p-value: 0.1249</code></pre>
<ul>
<li>The coefficient for ‘did’ is the differences-in-differences estimator.</li>
<li>The effect is significant at 10% with the treatment having a negative effect.</li>
</ul>
<!------------------------------>
</div>
<div id="card-and-krueger-1994-from-poedata" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Card and Krueger (1994) from PoEdata<a href="simple-did-estimator.html#card-and-krueger-1994-from-poedata" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!------------------------------>
<ul>
<li>The “PoEdata”” package loads into R the data sets that accompany Principles of Econometrics 4e, by Carter Hill, William Griffiths, and Guay Lim.</li>
<li>by Dr. Constantin Colonescu</li>
<li><a href="https://github.com/ccolonescu/PoEdata" class="uri">https://github.com/ccolonescu/PoEdata</a></li>
<li><a href="https://bookdown.org/ccolonescu/RPoE4/indvars.html#the-difference-in-differences-estimator" class="uri">https://bookdown.org/ccolonescu/RPoE4/indvars.html#the-difference-in-differences-estimator</a></li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="simple-did-estimator.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;njmin3&quot;</span>, <span class="at">package=</span><span class="st">&quot;PoEdata&quot;</span>)</span>
<span id="cb10-2"><a href="simple-did-estimator.html#cb10-2" aria-hidden="true" tabindex="-1"></a>?njmin3 <span class="co"># minimum wage example </span></span></code></pre></div>
<div id="models" class="section level3 hasAnchor" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Models<a href="simple-did-estimator.html#models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="simple-did-estimator.html#cb11-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(fte<span class="sc">~</span>nj<span class="sc">*</span>d, <span class="at">data=</span>njmin3)</span>
<span id="cb11-2"><a href="simple-did-estimator.html#cb11-2" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(fte<span class="sc">~</span>nj<span class="sc">*</span>d<span class="sc">+</span></span>
<span id="cb11-3"><a href="simple-did-estimator.html#cb11-3" aria-hidden="true" tabindex="-1"></a>             kfc<span class="sc">+</span>roys<span class="sc">+</span>wendys<span class="sc">+</span>co_owned, <span class="at">data=</span>njmin3)</span>
<span id="cb11-4"><a href="simple-did-estimator.html#cb11-4" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(fte<span class="sc">~</span>nj<span class="sc">*</span>d<span class="sc">+</span></span>
<span id="cb11-5"><a href="simple-did-estimator.html#cb11-5" aria-hidden="true" tabindex="-1"></a>             kfc<span class="sc">+</span>roys<span class="sc">+</span>wendys<span class="sc">+</span>co_owned<span class="sc">+</span></span>
<span id="cb11-6"><a href="simple-did-estimator.html#cb11-6" aria-hidden="true" tabindex="-1"></a>             southj<span class="sc">+</span>centralj<span class="sc">+</span>pa1, <span class="at">data=</span>njmin3)</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="simple-did-estimator.html#cb12-1" aria-hidden="true" tabindex="-1"></a>stargazer<span class="sc">::</span><span class="fu">stargazer</span>(mod1, mod2, mod3, </span>
<span id="cb12-2"><a href="simple-did-estimator.html#cb12-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type =</span> <span class="st">&#39;text&#39;</span>, <span class="at">model.names =</span> <span class="cn">FALSE</span>, </span>
<span id="cb12-3"><a href="simple-did-estimator.html#cb12-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">header=</span><span class="cn">FALSE</span>, <span class="at">keep.stat=</span><span class="st">&quot;n&quot;</span>,<span class="at">digits=</span><span class="dv">2</span>, </span>
<span id="cb12-4"><a href="simple-did-estimator.html#cb12-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">column.labels =</span> <span class="fu">c</span>(<span class="st">&#39;DID&#39;</span>, <span class="st">&#39;DIDw/Cov&#39;</span>, <span class="st">&#39;DIDw/All&#39;</span>))</span></code></pre></div>
<pre><code>## 
## ==========================================
##                   Dependent variable:     
##              -----------------------------
##                           fte             
##                 DID    DIDw/Cov  DIDw/All 
##                 (1)       (2)       (3)   
## ------------------------------------------
## nj            -2.89**   -2.38**    -0.91  
##               (1.19)    (1.08)    (1.27)  
##                                           
## d              -2.17     -2.22     -2.21  
##               (1.52)    (1.37)    (1.35)  
##                                           
## kfc                    -10.45*** -10.06***
##                         (0.85)    (0.84)  
##                                           
## roys                    -1.62*    -1.69** 
##                         (0.86)    (0.86)  
##                                           
## wendys                   -1.06     -1.06  
##                         (0.93)    (0.92)  
##                                           
## co_owned                 -1.17     -0.72  
##                         (0.72)    (0.72)  
##                                           
## southj                           -3.70*** 
##                                   (0.78)  
##                                           
## centralj                           0.01   
##                                   (0.90)  
##                                           
## pa1                                0.92   
##                                   (1.38)  
##                                           
## nj:d           2.75      2.85*     2.81*  
##               (1.69)    (1.52)    (1.50)  
##                                           
## Constant     23.33***  25.95***  25.32*** 
##               (1.07)    (1.04)    (1.21)  
##                                           
## ------------------------------------------
## Observations    794       794       794   
## ==========================================
## Note:          *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
<!------------------------------>
</div>
</div>
<div id="optional-demo-of-honestdid-rambachan-roth-2022" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Optional: Demo of HonestDiD (Rambachan &amp; Roth, 2022)<a href="simple-did-estimator.html#optional-demo-of-honestdid-rambachan-roth-2022" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!------------------------------>
<p>See original tutorial: <a href="https://github.com/asheshrambachan/HonestDiD" class="uri">https://github.com/asheshrambachan/HonestDiD</a></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="simple-did-estimator.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code></pre></div>
<pre><code>## here() starts at /Users/gejiang/Box Sync/MacSync/Teaching/574Quasi-Experimental/Class2022/Lectures/R_Book_QuasiExperiments</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="simple-did-estimator.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:car&#39;:
## 
##     recode</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="simple-did-estimator.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(did)</span>
<span id="cb21-2"><a href="simple-did-estimator.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rglpk)</span></code></pre></div>
<pre><code>## Loading required package: slam</code></pre>
<pre><code>## Using the GLPK callable library version 5.0</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="simple-did-estimator.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb24-2"><a href="simple-did-estimator.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb24-3"><a href="simple-did-estimator.html#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb24-4"><a href="simple-did-estimator.html#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(HonestDiD)</span></code></pre></div>
<pre><code>## Loading required package: CVXR</code></pre>
<pre><code>## 
## Attaching package: &#39;CVXR&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     id</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     power</code></pre>
<pre><code>## Loading required package: doParallel</code></pre>
<pre><code>## Loading required package: foreach</code></pre>
<pre><code>## Loading required package: iterators</code></pre>
<pre><code>## Loading required package: parallel</code></pre>
<pre><code>## Loading required package: latex2exp</code></pre>
<pre><code>## Loading required package: lpSolveAPI</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## Loading required package: pracma</code></pre>
<pre><code>## 
## Attaching package: &#39;pracma&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:Matrix&#39;:
## 
##     expm, lu, tril, triu</code></pre>
<pre><code>## The following objects are masked from &#39;package:CVXR&#39;:
## 
##     conv, grad, size</code></pre>
<pre><code>## The following object is masked from &#39;package:car&#39;:
## 
##     logit</code></pre>
<pre><code>## Loading required package: purrr</code></pre>
<pre><code>## 
## Attaching package: &#39;purrr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:pracma&#39;:
## 
##     cross</code></pre>
<pre><code>## The following objects are masked from &#39;package:foreach&#39;:
## 
##     accumulate, when</code></pre>
<pre><code>## The following object is masked from &#39;package:CVXR&#39;:
## 
##     is_vector</code></pre>
<pre><code>## The following object is masked from &#39;package:car&#39;:
## 
##     some</code></pre>
<pre><code>## Loading required package: ROI</code></pre>
<pre><code>## ROI: R Optimization Infrastructure</code></pre>
<pre><code>## Registered solver plugins: nlminb.</code></pre>
<pre><code>## Default solver: auto.</code></pre>
<pre><code>## 
## Attaching package: &#39;ROI&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:CVXR&#39;:
## 
##     constraints, constraints&lt;-, objective, objective&lt;-</code></pre>
<pre><code>## Loading required package: tidyverse</code></pre>
<pre><code>## Found more than one class &quot;atomicVector&quot; in cache; using the first, from namespace &#39;Matrix&#39;</code></pre>
<pre><code>## Also defined by &#39;Rmpfr&#39;</code></pre>
<pre><code>## Found more than one class &quot;atomicVector&quot; in cache; using the first, from namespace &#39;Matrix&#39;</code></pre>
<pre><code>## Also defined by &#39;Rmpfr&#39;</code></pre>
<pre><code>## Found more than one class &quot;atomicVector&quot; in cache; using the first, from namespace &#39;Matrix&#39;</code></pre>
<pre><code>## Also defined by &#39;Rmpfr&#39;</code></pre>
<pre><code>## Found more than one class &quot;atomicVector&quot; in cache; using the first, from namespace &#39;Matrix&#39;</code></pre>
<pre><code>## Also defined by &#39;Rmpfr&#39;</code></pre>
<pre><code>## Found more than one class &quot;atomicVector&quot; in cache; using the first, from namespace &#39;Matrix&#39;</code></pre>
<pre><code>## Also defined by &#39;Rmpfr&#39;</code></pre>
<pre><code>## Found more than one class &quot;atomicVector&quot; in cache; using the first, from namespace &#39;Matrix&#39;</code></pre>
<pre><code>## Also defined by &#39;Rmpfr&#39;</code></pre>
<pre><code>## Found more than one class &quot;atomicVector&quot; in cache; using the first, from namespace &#39;Matrix&#39;</code></pre>
<pre><code>## Also defined by &#39;Rmpfr&#39;</code></pre>
<pre><code>## Found more than one class &quot;atomicVector&quot; in cache; using the first, from namespace &#39;Matrix&#39;</code></pre>
<pre><code>## Also defined by &#39;Rmpfr&#39;</code></pre>
<pre><code>## Found more than one class &quot;atomicVector&quot; in cache; using the first, from namespace &#39;Matrix&#39;</code></pre>
<pre><code>## Also defined by &#39;Rmpfr&#39;</code></pre>
<pre><code>## Found more than one class &quot;atomicVector&quot; in cache; using the first, from namespace &#39;Matrix&#39;</code></pre>
<pre><code>## Also defined by &#39;Rmpfr&#39;</code></pre>
<pre><code>## Found more than one class &quot;atomicVector&quot; in cache; using the first, from namespace &#39;Matrix&#39;</code></pre>
<pre><code>## Also defined by &#39;Rmpfr&#39;</code></pre>
<pre><code>## Found more than one class &quot;atomicVector&quot; in cache; using the first, from namespace &#39;Matrix&#39;</code></pre>
<pre><code>## Also defined by &#39;Rmpfr&#39;</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
## ✔ tibble  3.1.8     ✔ stringr 1.4.0
## ✔ tidyr   1.2.1     ✔ forcats 0.5.2
## ✔ readr   2.1.2     
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ purrr::accumulate() masks foreach::accumulate()
## ✖ purrr::cross()      masks pracma::cross()
## ✖ tidyr::expand()     masks Matrix::expand()
## ✖ dplyr::filter()     masks stats::filter()
## ✖ CVXR::id()          masks dplyr::id()
## ✖ purrr::is_vector()  masks CVXR::is_vector()
## ✖ dplyr::lag()        masks stats::lag()
## ✖ tidyr::pack()       masks Matrix::pack()
## ✖ dplyr::recode()     masks car::recode()
## ✖ purrr::some()       masks car::some()
## ✖ tidyr::unpack()     masks Matrix::unpack()
## ✖ purrr::when()       masks foreach::when()
## Loading required package: TruncatedNormal</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="simple-did-estimator.html#cb79-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">&quot;https://raw.githubusercontent.com/Mixtape-Sessions/Advanced-DID/main/Exercises/Data/ehec_data.dta&quot;</span>)</span>
<span id="cb79-2"><a href="simple-did-estimator.html#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##        stfips        year  dins yexp2      W
##     &lt;dbl+lbl&gt;   &lt;dbl+lbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 1 [alabama] 2008 [2008] 0.681    NA 613156
## 2 1 [alabama] 2009 [2009] 0.658    NA 613156
## 3 1 [alabama] 2010 [2010] 0.631    NA 613156
## 4 1 [alabama] 2011 [2011] 0.656    NA 613156
## 5 1 [alabama] 2012 [2012] 0.671    NA 613156</code></pre>
<div id="estimate-the-baseline-did" class="section level3 hasAnchor" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Estimate the baseline DiD<a href="simple-did-estimator.html#estimate-the-baseline-did" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="simple-did-estimator.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Keep years before 2016. Drop the 2016 cohort</span></span>
<span id="cb81-2"><a href="simple-did-estimator.html#cb81-2" aria-hidden="true" tabindex="-1"></a>df_nonstaggered <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&lt;</span> <span class="dv">2016</span> <span class="sc">&amp;</span> </span>
<span id="cb81-3"><a href="simple-did-estimator.html#cb81-3" aria-hidden="true" tabindex="-1"></a>                                 (<span class="fu">is.na</span>(yexp2)<span class="sc">|</span> yexp2 <span class="sc">!=</span> <span class="dv">2015</span>) )</span>
<span id="cb81-4"><a href="simple-did-estimator.html#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="simple-did-estimator.html#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a treatment dummy</span></span>
<span id="cb81-6"><a href="simple-did-estimator.html#cb81-6" aria-hidden="true" tabindex="-1"></a>df_nonstaggered <span class="ot">&lt;-</span> df_nonstaggered <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">D =</span> <span class="fu">case_when</span>( yexp2 <span class="sc">==</span> <span class="dv">2014</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb81-7"><a href="simple-did-estimator.html#cb81-7" aria-hidden="true" tabindex="-1"></a>                                                             T <span class="sc">~</span> <span class="dv">0</span>)) </span>
<span id="cb81-8"><a href="simple-did-estimator.html#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="simple-did-estimator.html#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Run the TWFE spec</span></span>
<span id="cb81-10"><a href="simple-did-estimator.html#cb81-10" aria-hidden="true" tabindex="-1"></a>twfe_results <span class="ot">&lt;-</span> fixest<span class="sc">::</span><span class="fu">feols</span>(dins <span class="sc">~</span> <span class="fu">i</span>(year, D, <span class="at">ref =</span> <span class="dv">2013</span>) <span class="sc">|</span> stfips <span class="sc">+</span> year, </span>
<span id="cb81-11"><a href="simple-did-estimator.html#cb81-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cluster =</span> <span class="st">&quot;stfips&quot;</span>,</span>
<span id="cb81-12"><a href="simple-did-estimator.html#cb81-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> df_nonstaggered)</span>
<span id="cb81-13"><a href="simple-did-estimator.html#cb81-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-14"><a href="simple-did-estimator.html#cb81-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-15"><a href="simple-did-estimator.html#cb81-15" aria-hidden="true" tabindex="-1"></a>betahat <span class="ot">&lt;-</span> <span class="fu">summary</span>(twfe_results)<span class="sc">$</span>coefficients <span class="co">#save the coefficients</span></span>
<span id="cb81-16"><a href="simple-did-estimator.html#cb81-16" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">summary</span>(twfe_results)<span class="sc">$</span>cov.scaled <span class="co">#save the covariance matrix</span></span>
<span id="cb81-17"><a href="simple-did-estimator.html#cb81-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-18"><a href="simple-did-estimator.html#cb81-18" aria-hidden="true" tabindex="-1"></a>fixest<span class="sc">::</span><span class="fu">iplot</span>(twfe_results)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="sensitivity-analysis-using-relative-magnitudes-restrictions" class="section level3 hasAnchor" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> Sensitivity analysis using relative magnitudes restrictions<a href="simple-did-estimator.html#sensitivity-analysis-using-relative-magnitudes-restrictions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="simple-did-estimator.html#cb82-1" aria-hidden="true" tabindex="-1"></a>delta_rm_results <span class="ot">&lt;-</span> </span>
<span id="cb82-2"><a href="simple-did-estimator.html#cb82-2" aria-hidden="true" tabindex="-1"></a>HonestDiD<span class="sc">::</span><span class="fu">createSensitivityResults_relativeMagnitudes</span>(</span>
<span id="cb82-3"><a href="simple-did-estimator.html#cb82-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">betahat =</span> betahat, <span class="co">#coefficients</span></span>
<span id="cb82-4"><a href="simple-did-estimator.html#cb82-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">sigma =</span> sigma, <span class="co">#covariance matrix</span></span>
<span id="cb82-5"><a href="simple-did-estimator.html#cb82-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">numPrePeriods =</span> <span class="dv">5</span>, <span class="co">#num. of pre-treatment coefs</span></span>
<span id="cb82-6"><a href="simple-did-estimator.html#cb82-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">numPostPeriods =</span> <span class="dv">2</span>, <span class="co">#num. of post-treatment coefs</span></span>
<span id="cb82-7"><a href="simple-did-estimator.html#cb82-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Mbarvec =</span> <span class="fu">seq</span>(<span class="fl">0.5</span>,<span class="dv">2</span>,<span class="at">by=</span><span class="fl">0.5</span>) <span class="co">#values of Mbar</span></span>
<span id="cb82-8"><a href="simple-did-estimator.html#cb82-8" aria-hidden="true" tabindex="-1"></a>                                    )</span>
<span id="cb82-9"><a href="simple-did-estimator.html#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="simple-did-estimator.html#cb82-10" aria-hidden="true" tabindex="-1"></a>delta_rm_results</span></code></pre></div>
<pre><code>## # A tibble: 4 × 5
##          lb     ub method Delta    Mbar
##       &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;
## 1  0.0240   0.0672 C-LF   DeltaRM   0.5
## 2  0.0170   0.0720 C-LF   DeltaRM   1  
## 3  0.00824  0.0797 C-LF   DeltaRM   1.5
## 4 -0.000916 0.0881 C-LF   DeltaRM   2</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="simple-did-estimator.html#cb84-1" aria-hidden="true" tabindex="-1"></a>originalResults <span class="ot">&lt;-</span> HonestDiD<span class="sc">::</span><span class="fu">constructOriginalCS</span>(<span class="at">betahat =</span> betahat,</span>
<span id="cb84-2"><a href="simple-did-estimator.html#cb84-2" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma =</span> sigma,</span>
<span id="cb84-3"><a href="simple-did-estimator.html#cb84-3" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">numPrePeriods =</span> <span class="dv">5</span>,</span>
<span id="cb84-4"><a href="simple-did-estimator.html#cb84-4" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">numPostPeriods =</span> <span class="dv">2</span>)</span>
<span id="cb84-5"><a href="simple-did-estimator.html#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="simple-did-estimator.html#cb84-6" aria-hidden="true" tabindex="-1"></a>HonestDiD<span class="sc">::</span><span class="fu">createSensitivityPlot_relativeMagnitudes</span>(delta_rm_results, originalResults)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<!------------------------------>
</div>
</div>
<div id="optional-synthetic-control" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> Optional: Synthetic Control<a href="simple-did-estimator.html#optional-synthetic-control" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!------------------------------>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="simple-did-estimator.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span>
<span id="cb85-2"><a href="simple-did-estimator.html#cb85-2" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;edunford/tidysynth&quot;</span>)</span>
<span id="cb85-3"><a href="simple-did-estimator.html#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidysynth)</span></code></pre></div>
<div id="smoking-data" class="section level3 hasAnchor" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> Smoking data<a href="simple-did-estimator.html#smoking-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="simple-did-estimator.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;smoking&quot;</span>)</span>
<span id="cb86-2"><a href="simple-did-estimator.html#cb86-2" aria-hidden="true" tabindex="-1"></a>smoking <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1,209
## Columns: 7
## $ state     &lt;chr&gt; &quot;Rhode Island&quot;, &quot;Tennessee&quot;, &quot;Indiana&quot;, &quot;Nevada&quot;, &quot;Louisiana…
## $ year      &lt;dbl&gt; 1970, 1970, 1970, 1970, 1970, 1970, 1970, 1970, 1970, 1970, …
## $ cigsale   &lt;dbl&gt; 123.9, 99.8, 134.6, 189.5, 115.9, 108.4, 265.7, 93.8, 100.3,…
## $ lnincome  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ beer      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ age15to24 &lt;dbl&gt; 0.1831579, 0.1780438, 0.1765159, 0.1615542, 0.1851852, 0.175…
## $ retprice  &lt;dbl&gt; 39.3, 39.9, 30.6, 38.9, 34.3, 38.4, 31.4, 37.3, 36.7, 28.8, …</code></pre>
</div>
<div id="generate-control" class="section level3 hasAnchor" number="7.5.2">
<h3><span class="header-section-number">7.5.2</span> Generate Control<a href="simple-did-estimator.html#generate-control" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The method aims to generate a synthetic California using information from a subset of control states (the “donor pool”) where a similar law was not implemented. The donor pool is the subset of case comparisons from which information is borrowed to generate a synthetic version of the treated unit (“California”).</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="simple-did-estimator.html#cb88-1" aria-hidden="true" tabindex="-1"></a>smoking_out <span class="ot">&lt;-</span></span>
<span id="cb88-2"><a href="simple-did-estimator.html#cb88-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-3"><a href="simple-did-estimator.html#cb88-3" aria-hidden="true" tabindex="-1"></a>  smoking <span class="sc">%&gt;%</span></span>
<span id="cb88-4"><a href="simple-did-estimator.html#cb88-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-5"><a href="simple-did-estimator.html#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initial the synthetic control object</span></span>
<span id="cb88-6"><a href="simple-did-estimator.html#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">synthetic_control</span>(<span class="at">outcome =</span> cigsale, <span class="co"># outcome</span></span>
<span id="cb88-7"><a href="simple-did-estimator.html#cb88-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">unit =</span> state, <span class="co"># unit index in the panel data</span></span>
<span id="cb88-8"><a href="simple-did-estimator.html#cb88-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">time =</span> year, <span class="co"># time index in the panel data</span></span>
<span id="cb88-9"><a href="simple-did-estimator.html#cb88-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">i_unit =</span> <span class="st">&quot;California&quot;</span>, <span class="co"># unit where the intervention occurred</span></span>
<span id="cb88-10"><a href="simple-did-estimator.html#cb88-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">i_time =</span> <span class="dv">1988</span>, <span class="co"># time period when the intervention occurred</span></span>
<span id="cb88-11"><a href="simple-did-estimator.html#cb88-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">generate_placebos=</span>T <span class="co"># generate placebo synthetic controls (for inference)</span></span>
<span id="cb88-12"><a href="simple-did-estimator.html#cb88-12" aria-hidden="true" tabindex="-1"></a>                    ) <span class="sc">%&gt;%</span></span>
<span id="cb88-13"><a href="simple-did-estimator.html#cb88-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-14"><a href="simple-did-estimator.html#cb88-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate the aggregate predictors used to fit the weights</span></span>
<span id="cb88-15"><a href="simple-did-estimator.html#cb88-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-16"><a href="simple-did-estimator.html#cb88-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average log income, retail price of cigarettes, and proportion of the</span></span>
<span id="cb88-17"><a href="simple-did-estimator.html#cb88-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># population between 15 and 24 years of age from 1980 - 1988</span></span>
<span id="cb88-18"><a href="simple-did-estimator.html#cb88-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate_predictor</span>(<span class="at">time_window =</span> <span class="dv">1980</span><span class="sc">:</span><span class="dv">1988</span>,</span>
<span id="cb88-19"><a href="simple-did-estimator.html#cb88-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ln_income =</span> <span class="fu">mean</span>(lnincome, <span class="at">na.rm =</span> T),</span>
<span id="cb88-20"><a href="simple-did-estimator.html#cb88-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ret_price =</span> <span class="fu">mean</span>(retprice, <span class="at">na.rm =</span> T),</span>
<span id="cb88-21"><a href="simple-did-estimator.html#cb88-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">youth =</span> <span class="fu">mean</span>(age15to24, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb88-22"><a href="simple-did-estimator.html#cb88-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-23"><a href="simple-did-estimator.html#cb88-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average beer consumption in the donor pool from 1984 - 1988</span></span>
<span id="cb88-24"><a href="simple-did-estimator.html#cb88-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate_predictor</span>(<span class="at">time_window =</span> <span class="dv">1984</span><span class="sc">:</span><span class="dv">1988</span>,</span>
<span id="cb88-25"><a href="simple-did-estimator.html#cb88-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">beer_sales =</span> <span class="fu">mean</span>(beer, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb88-26"><a href="simple-did-estimator.html#cb88-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-27"><a href="simple-did-estimator.html#cb88-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lagged cigarette sales </span></span>
<span id="cb88-28"><a href="simple-did-estimator.html#cb88-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate_predictor</span>(<span class="at">time_window =</span> <span class="dv">1975</span>,</span>
<span id="cb88-29"><a href="simple-did-estimator.html#cb88-29" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cigsale_1975 =</span> cigsale) <span class="sc">%&gt;%</span></span>
<span id="cb88-30"><a href="simple-did-estimator.html#cb88-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate_predictor</span>(<span class="at">time_window =</span> <span class="dv">1980</span>,</span>
<span id="cb88-31"><a href="simple-did-estimator.html#cb88-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cigsale_1980 =</span> cigsale) <span class="sc">%&gt;%</span></span>
<span id="cb88-32"><a href="simple-did-estimator.html#cb88-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate_predictor</span>(<span class="at">time_window =</span> <span class="dv">1988</span>,</span>
<span id="cb88-33"><a href="simple-did-estimator.html#cb88-33" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cigsale_1988 =</span> cigsale) <span class="sc">%&gt;%</span></span>
<span id="cb88-34"><a href="simple-did-estimator.html#cb88-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-35"><a href="simple-did-estimator.html#cb88-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-36"><a href="simple-did-estimator.html#cb88-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate the fitted weights for the synthetic control</span></span>
<span id="cb88-37"><a href="simple-did-estimator.html#cb88-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate_weights</span>(<span class="at">optimization_window =</span> <span class="dv">1970</span><span class="sc">:</span><span class="dv">1988</span>, <span class="co"># time to use in the optimization task</span></span>
<span id="cb88-38"><a href="simple-did-estimator.html#cb88-38" aria-hidden="true" tabindex="-1"></a>                   <span class="at">margin_ipop =</span> .<span class="dv">02</span>,<span class="at">sigf_ipop =</span> <span class="dv">7</span>,<span class="at">bound_ipop =</span> <span class="dv">6</span> <span class="co"># optimizer options</span></span>
<span id="cb88-39"><a href="simple-did-estimator.html#cb88-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb88-40"><a href="simple-did-estimator.html#cb88-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-41"><a href="simple-did-estimator.html#cb88-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate the synthetic control</span></span>
<span id="cb88-42"><a href="simple-did-estimator.html#cb88-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate_control</span>()</span></code></pre></div>
<p>Once the synthetic control is generated, one can easily assess the fit by comparing the trends of the synthetic and observed time series. The idea is that the trends in the pre-intervention period should map closely onto one another.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="simple-did-estimator.html#cb89-1" aria-hidden="true" tabindex="-1"></a>smoking_out <span class="sc">%&gt;%</span> <span class="fu">plot_trends</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>To capture the causal quantity (i.e. the difference between the observed and counterfactual), one can plot the differences using plot_differences()</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="simple-did-estimator.html#cb90-1" aria-hidden="true" tabindex="-1"></a>smoking_out <span class="sc">%&gt;%</span> <span class="fu">plot_differences</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>In addition, one can easily examine the weighting of the units and variables in the fit. This allows one to see which cases were used, in part, to generate the synthetic control.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="simple-did-estimator.html#cb91-1" aria-hidden="true" tabindex="-1"></a>smoking_out <span class="sc">%&gt;%</span> <span class="fu">plot_weights</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-20-1.png" width="3000" style="display: block; margin: auto;" /></p>
<p>Another useful way of evaluating the synthetic control is to look at how comparable the synthetic control is to the observed covariates of the treated unit.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="simple-did-estimator.html#cb92-1" aria-hidden="true" tabindex="-1"></a>smoking_out <span class="sc">%&gt;%</span> <span class="fu">grab_balance_table</span>()</span></code></pre></div>
<pre><code>## # A tibble: 7 × 4
##   variable     California synthetic_California donor_sample
##   &lt;chr&gt;             &lt;dbl&gt;                &lt;dbl&gt;        &lt;dbl&gt;
## 1 ln_income        10.1                  9.85         9.83 
## 2 ret_price        89.4                 89.4         87.3  
## 3 youth             0.174                0.174        0.173
## 4 beer_sales       24.3                 24.2         23.7  
## 5 cigsale_1975    127.                 127.         137.   
## 6 cigsale_1980    120.                 120.         138.   
## 7 cigsale_1988     90.1                 91.4        114.</code></pre>
</div>
<div id="inference" class="section level3 hasAnchor" number="7.5.3">
<h3><span class="header-section-number">7.5.3</span> Inference<a href="simple-did-estimator.html#inference" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For inference, the method relies on repeating the method for every donor in the donor pool exactly as was done for the treated unit - i.e. generating <em>placebo</em> synthetic controls). By setting <code>generate_placebos = TRUE</code> when initializing the synth pipeline with <code>synthetic_control()</code>, placebo cases are automatically generated when constructing the synthetic control of interest. This makes it easy to explore how unique difference between the observed and synthetic unit is when compared to the placebos.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="simple-did-estimator.html#cb94-1" aria-hidden="true" tabindex="-1"></a>smoking_out <span class="sc">%&gt;%</span> <span class="fu">plot_placebos</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>there is a significance table that can be extracted with one of the many <code>grab_</code> prefix functions.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="simple-did-estimator.html#cb95-1" aria-hidden="true" tabindex="-1"></a>smoking_out <span class="sc">%&gt;%</span> <span class="fu">grab_significance</span>()</span></code></pre></div>
<pre><code>## # A tibble: 39 × 8
##    unit_name      type    pre_mspe post_mspe mspe_ratio  rank fishers_…¹ z_score
##    &lt;chr&gt;          &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;      &lt;dbl&gt;   &lt;dbl&gt;
##  1 California     Treated     3.17     392.      124.       1     0.0256  5.32  
##  2 Georgia        Donor       3.79     179.       47.2      2     0.0513  1.70  
##  3 Indiana        Donor      25.2      770.       30.6      3     0.0769  0.916 
##  4 West Virginia  Donor       9.52     284.       29.8      4     0.103   0.881 
##  5 Wisconsin      Donor      11.1      268.       24.1      5     0.128   0.607 
##  6 Missouri       Donor       3.03      67.8      22.4      6     0.154   0.528 
##  7 Texas          Donor      14.4      277.       19.3      7     0.179   0.383 
##  8 South Carolina Donor      12.6      234.       18.6      8     0.205   0.351 
##  9 Virginia       Donor       9.81      96.4       9.83     9     0.231  -0.0646
## 10 Nebraska       Donor       6.30      52.9       8.40    10     0.256  -0.132 
## # … with 29 more rows, and abbreviated variable name ¹​fishers_exact_pvalue</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="propensity-score-analysis.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/YOUR GITHUB USERNAME/YOUR REPO NAME/edit/master/07-PrepostDID.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/YOUR GITHUB USERNAME/YOUR REPO NAME/blob/master/07-PrepostDID.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
